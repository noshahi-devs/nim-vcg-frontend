<div class="dashboard-main-body">
  <app-breadcrumb [title]="title"></app-breadcrumb>

  <!-- Summary Cards -->
  <div class="row row-cols-xxxl-3 row-cols-lg-3 row-cols-sm-2 row-cols-1 gy-4 mb-24">
    <div class="col">
      <div class="card shadow-none border bg-gradient-start-3 h-100">
        <div class="card-body p-20">
          <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
            <div>
              <p class="fw-medium text-primary-light mb-1">Total Bank Balance</p>
              <h4 class="mb-0 text-info-main">{{ formatCurrency(totalBankBalance) }}</h4>
            </div>
            <div class="w-50-px h-50-px bg-info rounded-circle d-flex justify-content-center align-items-center">
              <iconify-icon icon="mdi:bank" class="text-white text-2xl mb-0"></iconify-icon>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col">
      <div class="card shadow-none border bg-gradient-start-4 h-100">
        <div class="card-body p-20">
          <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
            <div>
              <p class="fw-medium text-primary-light mb-1">Total Cash Balance</p>
              <h4 class="mb-0 text-success-main">{{ formatCurrency(totalCashBalance) }}</h4>
            </div>
            <div
              class="w-50-px h-50-px bg-success-main rounded-circle d-flex justify-content-center align-items-center">
              <iconify-icon icon="mdi:cash-multiple" class="text-white text-2xl mb-0"></iconify-icon>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col">
      <div class="card shadow-none border bg-gradient-start-1 h-100">
        <div class="card-body p-20">
          <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
            <div>
              <p class="fw-medium text-primary-light mb-1">Total Balance</p>
              <h4 class="mb-0 text-primary-600">{{ formatCurrency(totalBalance) }}</h4>
            </div>
            <div class="w-50-px h-50-px bg-primary-600 rounded-circle d-flex justify-content-center align-items-center">
              <iconify-icon icon="mdi:wallet" class="text-white text-2xl mb-0"></iconify-icon>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="card h-100 p-0 radius-12">
    <div class="card-header border-bottom bg-base py-16 px-24">
      <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link" [class.active]="activeTab === 'bank'" (click)="activeTab = 'bank'" type="button">Bank
            Accounts</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" [class.active]="activeTab === 'cash'" (click)="activeTab = 'cash'" type="button">Cash
            Accounts</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" [class.active]="activeTab === 'gateway'" (click)="activeTab = 'gateway'"
            type="button">Payment Gateways</button>
        </li>
      </ul>
    </div>

    <div class="card-body p-24">
      <!-- Bank Accounts Tab -->
      <div *ngIf="activeTab === 'bank'">
        <div class="d-flex align-items-center justify-content-between mb-16">
          <h6 class="text-lg fw-semibold mb-0">Bank Accounts</h6>
          <button type="button" (click)="openAddBankModal()"
            class="btn btn-primary text-sm btn-sm px-12 py-8 radius-8 d-flex align-items-center gap-2">
            <iconify-icon icon="solar:add-circle-bold" class="icon text-xl"></iconify-icon>
            Add Bank Account
          </button>
        </div>

        <div class="table-responsive scroll-sm">
          <table class="table bordered-table sm-table mb-0">
            <thead>
              <tr>
                <th>Account Name</th>
                <th>Account Number</th>
                <th>Bank Name</th>
                <th class="text-end">Balance</th>
                <th>Status</th>
                <th class="text-center">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let account of bankAccounts">
                <td><span class="fw-semibold">{{ account.accountName }}</span></td>
                <td>{{ account.accountNumber }}</td>
                <td>{{ account.bankName }}</td>
                <td class="text-end fw-bold text-info-main">{{ formatCurrency(account.balance) }}</td>
                <td>
                  <span class="badge px-8 py-4 radius-4 fw-medium text-xs"
                    [ngClass]="account.isActive ? 'bg-success-focus text-success-main' : 'bg-danger-focus text-danger-main'">
                    {{ account.isActive ? 'Active' : 'Inactive' }}
                  </span>
                </td>
                <td class="text-center">
                  <div class="d-flex align-items-center justify-content-center gap-2">
                    <button type="button" (click)="openEditBankModal(account)"
                      class="bg-success-focus text-success-600 bg-hover-success-200 fw-medium w-40-px h-40-px d-flex justify-content-center align-items-center rounded-circle"
                      title="Edit">
                      <iconify-icon icon="lucide:edit" class="icon text-xl"></iconify-icon>
                    </button>
                    <button type="button" (click)="deleteBankAccount(account)"
                      class="bg-danger-focus text-danger-600 bg-hover-danger-200 fw-medium w-40-px h-40-px d-flex justify-content-center align-items-center rounded-circle"
                      title="Delete">
                      <iconify-icon icon="fluent:delete-24-regular" class="icon text-xl"></iconify-icon>
                    </button>
                  </div>
                </td>
              </tr>
              <tr *ngIf="bankAccounts.length === 0">
                <td colspan="6" class="text-center py-24 text-secondary-light">No bank accounts found</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Cash Accounts Tab -->
      <div *ngIf="activeTab === 'cash'">
        <div class="d-flex align-items-center justify-content-between mb-16">
          <h6 class="text-lg fw-semibold mb-0">Cash Accounts</h6>
          <button type="button" (click)="openAddCashModal()"
            class="btn btn-success text-sm btn-sm px-12 py-8 radius-8 d-flex align-items-center gap-2">
            <iconify-icon icon="solar:add-circle-bold" class="icon text-xl"></iconify-icon>
            Add Cash Account
          </button>
        </div>

        <div class="table-responsive scroll-sm">
          <table class="table bordered-table sm-table mb-0">
            <thead>
              <tr>
                <th>Account Name</th>
                <th>Location / Ref</th>
                <th class="text-end">Balance</th>
                <th>Status</th>
                <th class="text-center">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let account of cashAccounts">
                <td><span class="fw-semibold">{{ account.accountName }}</span></td>
                <td>{{ account.bankName }}</td> <!-- Using bankName for Location/Ref -->
                <td class="text-end fw-bold text-success-main">{{ formatCurrency(account.balance) }}</td>
                <td>
                  <span class="badge px-8 py-4 radius-4 fw-medium text-xs"
                    [ngClass]="account.isActive ? 'bg-success-focus text-success-main' : 'bg-danger-focus text-danger-main'">
                    {{ account.isActive ? 'Active' : 'Inactive' }}
                  </span>
                </td>
                <td class="text-center">
                  <div class="d-flex align-items-center justify-content-center gap-2">
                    <button type="button" (click)="openEditCashModal(account)"
                      class="bg-success-focus text-success-600 bg-hover-success-200 fw-medium w-40-px h-40-px d-flex justify-content-center align-items-center rounded-circle"
                      title="Edit">
                      <iconify-icon icon="lucide:edit" class="icon text-xl"></iconify-icon>
                    </button>
                    <button type="button" (click)="deleteCashAccount(account)"
                      class="bg-danger-focus text-danger-600 bg-hover-danger-200 fw-medium w-40-px h-40-px d-flex justify-content-center align-items-center rounded-circle"
                      title="Delete">
                      <iconify-icon icon="fluent:delete-24-regular" class="icon text-xl"></iconify-icon>
                    </button>
                  </div>
                </td>
              </tr>
              <tr *ngIf="cashAccounts.length === 0">
                <td colspan="5" class="text-center py-24 text-secondary-light">No cash accounts found</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Payment Gateways Tab -->
      <div *ngIf="activeTab === 'gateway'">
        <div class="d-flex align-items-center justify-content-between mb-16">
          <h6 class="text-lg fw-semibold mb-0">Payment Gateways</h6>
          <button type="button" (click)="openAddGatewayModal()"
            class="btn btn-warning text-sm btn-sm px-12 py-8 radius-8 d-flex align-items-center gap-2">
            <iconify-icon icon="solar:add-circle-bold" class="icon text-xl"></iconify-icon>
            Add Gateway
          </button>
        </div>

        <div class="table-responsive scroll-sm">
          <table class="table bordered-table sm-table mb-0">
            <thead>
              <tr>
                <th>Gateway Name</th>
                <th>API Key</th>
                <th>Secret Key</th>
                <th class="text-end">Transaction Fee (%)</th>
                <th>Status</th>
                <th class="text-center">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let gateway of paymentGateways">
                <td><span class="fw-semibold">{{ gateway.gatewayName }}</span></td>
                <td><code class="text-xs">{{ gateway.apiKey }}</code></td>
                <td><code class="text-xs">******</code></td>
                <td class="text-end fw-bold">{{ gateway.transactionFee }}%</td>
                <td>
                  <span class="badge px-8 py-4 radius-4 fw-medium text-xs"
                    [ngClass]="gateway.isActive ? 'bg-success-focus text-success-main' : 'bg-danger-focus text-danger-main'">
                    {{ gateway.isActive ? 'Active' : 'Inactive' }}
                  </span>
                </td>
                <td class="text-center">
                  <div class="d-flex align-items-center justify-content-center gap-2">
                    <button type="button" (click)="openEditGatewayModal(gateway)"
                      class="bg-success-focus text-success-600 bg-hover-success-200 fw-medium w-40-px h-40-px d-flex justify-content-center align-items-center rounded-circle"
                      title="Edit">
                      <iconify-icon icon="lucide:edit" class="icon text-xl"></iconify-icon>
                    </button>
                    <button type="button" (click)="deleteGateway(gateway)"
                      class="bg-danger-focus text-danger-600 bg-hover-danger-200 fw-medium w-40-px h-40-px d-flex justify-content-center align-items-center rounded-circle"
                      title="Delete">
                      <iconify-icon icon="fluent:delete-24-regular" class="icon text-xl"></iconify-icon>
                    </button>
                  </div>
                </td>
              </tr>
              <tr *ngIf="paymentGateways.length === 0">
                <td colspan="6" class="text-center py-24 text-secondary-light">No payment gateways found</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Bank Modal -->
<div class="modal fade" [class.show]="showBankModal" [style.display]="showBankModal ? 'block' : 'none'" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h6 class="modal-title">{{ isEditBankMode ? 'Edit Bank Account' : 'Add Bank Account' }}</h6>
        <button type="button" class="btn-close" (click)="closeBankModal()"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="row gy-3">
            <div class="col-md-6">
              <label class="form-label">Account Name *</label>
              <input type="text" class="form-control" [(ngModel)]="currentBankAccount.accountName" name="accountName">
            </div>
            <div class="col-md-6">
              <label class="form-label">Account Number *</label>
              <input type="text" class="form-control" [(ngModel)]="currentBankAccount.accountNumber"
                name="accountNumber">
            </div>
            <div class="col-md-6">
              <label class="form-label">Bank Name *</label>
              <input type="text" class="form-control" [(ngModel)]="currentBankAccount.bankName" name="bankName">
            </div>
            <div class="col-md-6">
              <label class="form-label">Balance *</label>
              <input type="number" class="form-control" [(ngModel)]="currentBankAccount.balance" name="balance">
            </div>
            <div class="col-md-6">
              <label class="form-label">Status *</label>
              <select class="form-select" [(ngModel)]="currentBankAccount.isActive" name="isActive">
                <option [ngValue]="true">Active</option>
                <option [ngValue]="false">Inactive</option>
              </select>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeBankModal()">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="saveBankAccount()">{{ isEditBankMode ? 'Update' : 'Save'
          }}</button>
      </div>
    </div>
  </div>
</div>
<div class="modal-backdrop fade" [class.show]="showBankModal" *ngIf="showBankModal"></div>

<!-- Cash Modal -->
<div class="modal fade" [class.show]="showCashModal" [style.display]="showCashModal ? 'block' : 'none'" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h6 class="modal-title">{{ isEditCashMode ? 'Edit Cash Account' : 'Add Cash Account' }}</h6>
        <button type="button" class="btn-close" (click)="closeCashModal()"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="row gy-3">
            <div class="col-12">
              <label class="form-label">Account Name *</label>
              <input type="text" class="form-control" [(ngModel)]="currentCashAccount.accountName" name="accountName">
            </div>
            <div class="col-12">
              <label class="form-label">Location / Ref *</label>
              <input type="text" class="form-control" [(ngModel)]="currentCashAccount.bankName" name="bankName">
            </div>
            <div class="col-12">
              <label class="form-label">Balance *</label>
              <input type="number" class="form-control" [(ngModel)]="currentCashAccount.balance" name="balance">
            </div>
            <div class="col-12">
              <label class="form-label">Status *</label>
              <select class="form-select" [(ngModel)]="currentCashAccount.isActive" name="isActive">
                <option [ngValue]="true">Active</option>
                <option [ngValue]="false">Inactive</option>
              </select>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeCashModal()">Cancel</button>
        <button type="button" class="btn btn-success" (click)="saveCashAccount()">{{ isEditCashMode ? 'Update' : 'Save'
          }}</button>
      </div>
    </div>
  </div>
</div>
<div class="modal-backdrop fade" [class.show]="showCashModal" *ngIf="showCashModal"></div>

<!-- Gateway Modal -->
<div class="modal fade" [class.show]="showGatewayModal" [style.display]="showGatewayModal ? 'block' : 'none'"
  tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h6 class="modal-title">{{ isEditGatewayMode ? 'Edit Payment Gateway' : 'Add Payment Gateway' }}</h6>
        <button type="button" class="btn-close" (click)="closeGatewayModal()"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="row gy-3">
            <div class="col-md-6">
              <label class="form-label">Gateway Name *</label>
              <input type="text" class="form-control" [(ngModel)]="currentGateway.gatewayName" name="gatewayName">
            </div>
            <div class="col-md-6">
              <label class="form-label">Transaction Fee (%) *</label>
              <input type="number" step="0.1" class="form-control" [(ngModel)]="currentGateway.transactionFee"
                name="transactionFee">
            </div>
            <div class="col-md-6">
              <label class="form-label">API Key *</label>
              <input type="text" class="form-control" [(ngModel)]="currentGateway.apiKey" name="apiKey">
            </div>
            <div class="col-md-6">
              <label class="form-label">Secret Key *</label>
              <input type="password" class="form-control" [(ngModel)]="currentGateway.secretKey" name="secretKey">
            </div>
            <div class="col-12">
              <label class="form-label">Status *</label>
              <select class="form-select" [(ngModel)]="currentGateway.isActive" name="isActive">
                <option [ngValue]="true">Active</option>
                <option [ngValue]="false">Inactive</option>
              </select>
            </div>
            <div class="col-12">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" [(ngModel)]="currentGateway.isTestMode"
                  name="isTestMode" id="testModeCheck">
                <label class="form-check-label" for="testModeCheck">
                  Test Mode (Sandbox)
                </label>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeGatewayModal()">Cancel</button>
        <button type="button" class="btn btn-warning" (click)="saveGateway()">{{ isEditGatewayMode ? 'Update' : 'Save'
          }}</button>
      </div>
    </div>
  </div>
</div>
<div class="modal-backdrop fade" [class.show]="showGatewayModal" *ngIf="showGatewayModal"></div>