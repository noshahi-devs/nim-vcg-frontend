<div class="dashboard-main-body">

  <!-- ══════ Page Header ══════ -->
  <div class="page-header-glass">
    <h4>Class Attendance Report</h4>
    <button class="btn-refresh-glass" (click)="loadReport()" *ngIf="selectedClassId">
      <iconify-icon icon="solar:refresh-linear"></iconify-icon> Refresh
    </button>
  </div>

  <!-- ══════ Stats Grid ══════ -->
  <div class="stats-row" *ngIf="reportData.length">
    <div class="stat-card-glass">
      <div class="stat-icon-circle primary">
        <iconify-icon icon="solar:users-group-two-rounded-bold-duotone"></iconify-icon>
      </div>
      <div>
        <div class="stat-label">Total Students</div>
        <div class="stat-value">{{ reportData.length }}</div>
      </div>
    </div>

    <div class="stat-card-glass">
      <div class="stat-icon-circle success">
        <iconify-icon icon="solar:check-circle-bold-duotone"></iconify-icon>
      </div>
      <div>
        <div class="stat-label">Present</div>
        <div class="stat-value text-success">{{ summary.present }}</div>
      </div>
    </div>

    <div class="stat-card-glass">
      <div class="stat-icon-circle danger">
        <iconify-icon icon="solar:close-circle-bold-duotone"></iconify-icon>
      </div>
      <div>
        <div class="stat-label">Absent</div>
        <div class="stat-value text-danger">{{ summary.absent }}</div>
      </div>
    </div>

    <div class="stat-card-glass">
      <div class="stat-icon-circle warning">
        <iconify-icon icon="solar:question-square-bold-duotone"></iconify-icon>
      </div>
      <div>
        <div class="stat-label">Unmarked</div>
        <div class="stat-value text-warning">{{ reportData.length - summary.present - summary.absent }}</div>
      </div>
    </div>
  </div>

  <!-- ══════ Filter Controls ══════ -->
  <div class="filter-glass">
    <div class="row g-4 align-items-end">
      <div class="col-md-4">
        <label class="form-label">Target Class</label>
        <div class="input-group">
          <span class="input-group-text">
            <iconify-icon icon="solar:folder-bold-duotone" class="text-primary"></iconify-icon>
          </span>
          <select class="form-select" [(ngModel)]="selectedClassId" (change)="loadReport()">
            <option [ngValue]="null">-- Select Class --</option>
            <option *ngFor="let cls of classes" [value]="cls.standardId">{{ cls.standardName }}</option>
          </select>
        </div>
      </div>
      <div class="col-md-4">
        <label class="form-label">Report Date</label>
        <div class="input-group">
          <span class="input-group-text">
            <iconify-icon icon="solar:calendar-bold-duotone" class="text-primary"></iconify-icon>
          </span>
          <input type="date" class="form-control" [(ngModel)]="selectedDate" (change)="loadReport()">
        </div>
      </div>
      <div class="col-md-4 d-flex justify-content-end">
        <button class="btn-generate" (click)="loadReport()" *ngIf="selectedClassId">
          <iconify-icon icon="solar:chart-square-bold-duotone"></iconify-icon>
          Generate Report
        </button>
      </div>
    </div>
  </div>

  <!-- ══════ Loading State ══════ -->
  <div *ngIf="isLoading" class="loading-glass">
    <div class="loading-spinner"></div>
    <p>Analysing Attendance Data...</p>
  </div>

  <!-- ══════ Result Table ══════ -->
  <div class="table-glass-container" *ngIf="!isLoading && reportData.length">
    <div class="table-glass-header">
      <h5>Attendance Details</h5>
      <span class="result-count">
        Showing <b>{{ reportData.length }}</b> students
      </span>
    </div>
    <div class="table-responsive">
      <table class="premium-table">
        <thead>
          <tr>
            <th class="ps-4">Roll No</th>
            <th>Student Name</th>
            <th>Status</th>
            <th class="pe-4">Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of reportData; let i = index" style="animation: fadeInUp 0.4s ease-out both"
            [style.animation-delay]="i * 0.04 + 's'">
            <td class="ps-4">
              <span class="roll-badge">{{ row.rollNo || '---' }}</span>
            </td>
            <td>
              <div class="student-info-cell">
                <div class="student-avatar-grad">
                  {{ row.studentName?.charAt(0) }}
                </div>
                <span class="student-name-text">{{ row.studentName }}</span>
              </div>
            </td>
            <td>
              <span class="status-pill" [ngClass]="{
                  'present': row.status === 'Present',
                  'absent': row.status === 'Absent',
                  'unmarked': row.status === 'Unmarked'
                }">
                <span class="status-dot" [ngClass]="{
                    'present': row.status === 'Present',
                    'absent': row.status === 'Absent',
                    'unmarked': row.status === 'Unmarked'
                  }"></span>
                {{ row.status }}
              </span>
            </td>
            <td class="pe-4">
              <a class="btn-profile" [routerLink]="['/student-view', row.studentId]">
                <iconify-icon icon="solar:user-bold-duotone"></iconify-icon>
                View Profile
              </a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ══════ Empty State ══════ -->
  <div *ngIf="!isLoading && !reportData.length && selectedClassId" class="empty-state-glass">
    <div class="empty-icon-circle">
      <iconify-icon icon="solar:document-text-bold-duotone"></iconify-icon>
    </div>
    <h4>No Records Found</h4>
    <p>No attendance data exists for this class on the selected date.</p>
  </div>
</div>