<div class="dashboard-main-body">
  <app-breadcrumb [title]="title"></app-breadcrumb>

  <div class="card radius-12">

    <!-- HEADER -->
    <div class="card-header d-flex justify-content-between">
      <div class="d-flex gap-3">
        <select class="form-select w-auto"
                [(ngModel)]="rowsPerPage"
                (change)="currentPage=1;updatePagination()">
          <option [value]="10">10</option>
          <option [value]="25">25</option>
          <option [value]="50">50</option>
        </select>

        <input class="form-control"
               placeholder="Search Exam / Standard"
               [(ngModel)]="searchTerm"
               (input)="search()">
      </div>

      <a routerLink="/exam-schedule-standards-create"
         class="btn btn-primary btn-sm">
        + Add Exam Schedule
      </a>
    </div>

    <!-- TABLE -->
    <div class="card-body table-responsive">
      <table class="table bordered-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Exam Schedule</th>
            <th>Standard</th>
            <th>Subjects</th>
            <th class="text-center">Actions</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let item of paginatedList; let i = index">
            <td>{{ (currentPage-1)*rowsPerPage + i + 1 }}</td>
            <td>{{ item.examScheduleName }}</td>
            <td>{{ item.standardName }}</td>
            <td>{{ item.examSubjects?.length || 0 }}</td>

            <td class="text-center">
              <button class="btn btn-info btn-sm"
                      (click)="openViewModal(item)">View</button>
              <button class="btn btn-success btn-sm"
                      (click)="openEditModal(item)">Edit</button>
              <button class="btn btn-danger btn-sm"
                      (click)="confirmDelete(item.examScheduleStandardId)">
                Delete
              </button>
            </td>
          </tr>

          <tr *ngIf="paginatedList.length === 0">
            <td colspan="5" class="text-center">No data found</td>
          </tr>
        </tbody>
      </table>

      <!-- PAGINATION -->
      <ul class="pagination justify-content-end mt-3">
        <li class="page-item"
            *ngFor="let p of [].constructor(totalPages); let i = index">
          <a class="page-link"
             [class.active]="currentPage===i+1"
             (click)="changePage(i+1)">
            {{ i+1 }}
          </a>
        </li>
      </ul>
    </div>
  </div>
</div>

<!-- VIEW MODAL -->
<div class="modal fade" id="viewModal">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5>Exam Details</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body" *ngIf="selectedItem">
        <p><b>Exam:</b> {{ selectedItem.examScheduleName }}</p>
        <p><b>Standard:</b> {{ selectedItem.standardName }}</p>

        <table class="table table-bordered">
          <tr *ngFor="let s of selectedItem.examSubjects">
            <td>{{ s.subjectName }}</td>
            <td>{{ s.examTypeName }}</td>
            <td>{{ s.examDate | date }}</td>
            <td>{{ s.examStartTime }} - {{ s.examEndTime }}</td>
          </tr>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- EDIT MODAL -->
<div class="modal fade" id="editModal">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5>Edit Exam Schedule</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <table class="table">
          <tr *ngFor="let s of editModel?.examSubjects">
            <td>{{ s.subjectName }}</td>
            <td><input type="date" [(ngModel)]="s.examDate" class="form-control"></td>
            <td><input type="time" [(ngModel)]="s.examStartTime" class="form-control"></td>
            <td><input type="time" [(ngModel)]="s.examEndTime" class="form-control"></td>
          </tr>
        </table>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-success" (click)="update()">Update</button>
      </div>
    </div>
  </div>
</div>

<!-- DELETE MODAL -->
<div class="modal fade" id="deleteModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content p-3 text-center">
      <p>Are you sure you want to delete?</p>
      <div class="d-flex justify-content-center gap-2">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-danger" (click)="delete()">Delete</button>
      </div>
    </div>
  </div>
</div>
