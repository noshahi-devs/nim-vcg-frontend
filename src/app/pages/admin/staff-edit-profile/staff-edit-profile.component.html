<div class="dashboard-main-body">
    <app-breadcrumb [title]="'Staff Profile'" [main-title]="'Edit Staff Profile'"></app-breadcrumb>

    <div class="row" *ngIf="staffData">
        <div class="col-12">
            <div class="edit-profile-card">
                <div class="card-body p-4 p-lg-5">

                    <!-- Streamlined Horizontal Navigation -->
                    <ul class="nav nav-pills premium-tabs mb-5" id="pills-tab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="pills-general-tab" data-bs-toggle="pill"
                                data-bs-target="#pills-general" type="button" role="tab">
                                <iconify-icon icon="solar:user-edit-bold-duotone"></iconify-icon>
                                General Details
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-security-tab" data-bs-toggle="pill"
                                data-bs-target="#pills-security" type="button" role="tab">
                                <iconify-icon icon="solar:lock-password-bold-duotone"></iconify-icon>
                                Account Security
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-notif-tab" data-bs-toggle="pill"
                                data-bs-target="#pills-notif" type="button" role="tab">
                                <iconify-icon icon="solar:bell-bing-bold-duotone"></iconify-icon>
                                Notifications
                            </button>
                        </li>
                    </ul>

                    <div class="tab-content" id="pills-tabContent">

                        <!-- Tab: General Info -->
                        <div class="tab-pane fade show active" id="pills-general" role="tabpanel">
                            <div class="row gx-lg-5">
                                <div class="col-lg-3 text-center mb-5 mb-lg-0">
                                    <div class="avatar-section">
                                        <div class="section-headline mx-auto" style="width: fit-content;">Profile Image
                                        </div>
                                        <div class="avatar-upload mx-auto mt-4">
                                            <div class="avatar-edit">
                                                <input type='file' id="imageUpload" accept=".png, .jpg, .jpeg" hidden>
                                                <label for="imageUpload">
                                                    <iconify-icon icon="solar:camera-bold"></iconify-icon>
                                                </label>
                                            </div>
                                            <div class="avatar-preview mx-auto">
                                                <div id="imagePreview"
                                                    [style.background-image]="'url(' + staffData.profile + ')'"></div>
                                            </div>
                                        </div>
                                        <p class="text-slate-400 small mt-4 fw-medium">Upload a professional
                                            high-resolution photo.</p>
                                    </div>
                                </div>

                                <div class="col-lg-9">
                                    <div class="section-headline">Personal Information</div>
                                    <form>
                                        <div class="row g-4">
                                            <div class="col-md-6">
                                                <label class="form-label">Full Name</label>
                                                <input type="text" class="form-control" [(ngModel)]="staffData.name"
                                                    name="name" placeholder="Enter full name">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Official Email</label>
                                                <input type="email" class="form-control" [(ngModel)]="staffData.email"
                                                    name="email" placeholder="example@noshahi.edu.pk">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Phone Number</label>
                                                <input type="text" class="form-control" [(ngModel)]="staffData.phone"
                                                    name="phone" placeholder="03xx-xxxxxxx">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">CNIC / ID Number</label>
                                                <input type="text" class="form-control" [(ngModel)]="staffData.cnic"
                                                    name="cnic" placeholder="xxxxx-xxxxxxx-x">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Employee Role</label>
                                                <select class="form-select" [(ngModel)]="staffData.role" name="role">
                                                    <option value="Teacher">Teacher</option>
                                                    <option value="Principal">Principal</option>
                                                    <option value="Admin">Admin</option>
                                                    <option value="Accountant">Accountant</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Academic Qualification</label>
                                                <input type="text" class="form-control"
                                                    [(ngModel)]="staffData.qualification" name="qualification"
                                                    placeholder="e.g. MS (Computer Science)">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Gender Orientation</label>
                                                <select class="form-select" [(ngModel)]="staffData.gender"
                                                    name="gender">
                                                    <option value="Male">Male</option>
                                                    <option value="Female">Female</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Date of Birth</label>
                                                <input type="date" class="form-control" [(ngModel)]="staffData.dob"
                                                    name="dob">
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Current Residential Address</label>
                                                <textarea class="form-control" rows="3" [(ngModel)]="staffData.address"
                                                    name="address" placeholder="Enter complete address"></textarea>
                                            </div>
                                        </div>

                                        <div class="mt-5 pt-4 d-flex gap-3 justify-content-end border-top">
                                            <button type="button" (click)="cancel()"
                                                class="btn btn-premium-cancel px-4">Cancel Changes</button>
                                            <button type="button" (click)="saveStaff()"
                                                class="btn btn-premium-save px-5">Save Profile</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Tab: Security -->
                        <div class="tab-pane fade" id="pills-security" role="tabpanel">
                            <div class="max-w-600-px mx-auto py-4">
                                <div class="section-headline">Update Security Credentials</div>
                                <div class="mb-4">
                                    <label class="form-label">Current Password</label>
                                    <div class="position-relative">
                                        <input type="password" class="form-control" id="curr-pass"
                                            placeholder="Enter your current password">
                                        <span
                                            class="toggle-password ri-eye-line position-absolute end-0 top-50 translate-middle-y me-3 text-slate-400 cursor-pointer"
                                            data-toggle="#curr-pass"></span>
                                    </div>
                                </div>
                                <div class="mb-4">
                                    <label class="form-label">New Password</label>
                                    <div class="position-relative">
                                        <input type="password" class="form-control" id="new-pass"
                                            placeholder="Create a strong new password">
                                        <span
                                            class="toggle-password ri-eye-line position-absolute end-0 top-50 translate-middle-y me-3 text-slate-400 cursor-pointer"
                                            data-toggle="#new-pass"></span>
                                    </div>
                                    <div class="text-slate-400 small mt-2 d-flex align-items-center gap-2">
                                        <iconify-icon icon="solar:info-circle-linear"></iconify-icon>
                                        At least 8 characters, one number and one special symbol.
                                    </div>
                                </div>
                                <div class="mb-5">
                                    <label class="form-label">Verify New Password</label>
                                    <div class="position-relative">
                                        <input type="password" class="form-control" id="conf-pass"
                                            placeholder="Confirm your new password">
                                        <span
                                            class="toggle-password ri-eye-line position-absolute end-0 top-50 translate-middle-y me-3 text-slate-400 cursor-pointer"
                                            data-toggle="#conf-pass"></span>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-end">
                                    <button type="button" (click)="updatePassword()"
                                        class="btn btn-premium-save px-5">Update Password</button>
                                </div>
                            </div>
                        </div>

                        <!-- Tab: Notifications -->
                        <div class="tab-pane fade" id="pills-notif" role="tabpanel">
                            <div class="max-w-700-px mx-auto py-4">
                                <div class="section-headline">Communication Preferences</div>

                                <div
                                    class="notification-item py-3 px-4 rounded-4 bg-light mb-3 d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="fw-bold text-dark">Security Alerts & Logins</div>
                                        <div class="text-slate-500 small">Get notified about new login attempts and MFA
                                            status.</div>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" checked>
                                    </div>
                                </div>

                                <div
                                    class="notification-item py-3 px-4 rounded-4 bg-light mb-3 d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="fw-bold text-dark">Staff & Task Updates</div>
                                        <div class="text-slate-500 small">Notifications for assigned tasks, schedules
                                            and exams.</div>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" checked>
                                    </div>
                                </div>

                                <div
                                    class="notification-item py-3 px-4 rounded-4 bg-light mb-5 d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="fw-bold text-dark">Institute Circulars</div>
                                        <div class="text-slate-500 small">Weekly news, events and important
                                            announcements.</div>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox">
                                    </div>
                                </div>

                                <div class="d-flex justify-content-end">
                                    <button type="button" class="btn btn-premium-save" (click)="saveStaff()">Save
                                        Preferences</button>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Refined Success Modal -->
<div class="modal fade" id="messageModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg p-5 text-center" style="border-radius: 22px;">
            <div class="mb-4">
                <div class="stat-icon-wrap green mx-auto"
                    style="width: 100px; height: 100px; font-size: 3rem; border-radius: 25px;">
                    <iconify-icon icon="solar:check-circle-bold-duotone" *ngIf="modalType === 'success'"></iconify-icon>
                    <iconify-icon icon="solar:danger-bold-duotone" class="text-danger"
                        *ngIf="modalType === 'error'"></iconify-icon>
                </div>
            </div>
            <h2 class="fw-bold text-dark mb-2">{{ modalType === 'success' ? 'Update Successful' : 'Error Occurred' }}
            </h2>
            <p class="text-slate-500 fs-5 mb-5">{{ modalMessage }}</p>
            <button type="button" class="btn btn-premium-save w-100 py-3" data-bs-dismiss="modal">Acknowledge</button>
        </div>
    </div>
</div>