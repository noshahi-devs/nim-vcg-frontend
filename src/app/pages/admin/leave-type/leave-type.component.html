<div class="dashboard-main-body">
  <app-breadcrumb [title]="title"></app-breadcrumb>

  <!-- ══════ Stats ══════ -->
  <div class="stats-row">
    <div class="stat-card-glass">
      <div class="stat-icon-circle primary">
        <iconify-icon icon="solar:document-text-bold-duotone"></iconify-icon>
      </div>
      <div>
        <div class="stat-label">Total Types</div>
        <div class="stat-value">{{ totalTypes }}</div>
      </div>
    </div>
    <div class="stat-card-glass">
      <div class="stat-icon-circle success">
        <iconify-icon icon="solar:check-circle-bold-duotone"></iconify-icon>
      </div>
      <div>
        <div class="stat-label">Active</div>
        <div class="stat-value text-success">{{ activeTypes }}</div>
      </div>
    </div>
    <div class="stat-card-glass">
      <div class="stat-icon-circle danger">
        <iconify-icon icon="solar:close-circle-bold-duotone"></iconify-icon>
      </div>
      <div>
        <div class="stat-label">Inactive</div>
        <div class="stat-value text-danger">{{ inactiveTypes }}</div>
      </div>
    </div>
  </div>

  <!-- ══════ Table ══════ -->
  <div class="table-glass-container">
    <div class="table-glass-header">
      <h5>Leave Configuration Master</h5>
      <button type="button" (click)="openAddModal()" class="btn-add-grad">
        <iconify-icon icon="ic:baseline-plus"></iconify-icon>
        Create New Type
      </button>
    </div>

    <div class="table-responsive">
      <table class="premium-table">
        <thead>
          <tr>
            <th class="ps-4">S.L</th>
            <th>Type Name</th>
            <th>Description</th>
            <th class="text-center">Max Allocation</th>
            <th class="text-center">Status</th>
            <th class="text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let type of paginatedTypes; let i = index" style="animation: fadeInUp 0.4s ease-out both"
            [style.animation-delay]="i * 0.04 + 's'">
            <td class="ps-4"><span class="fw-bold" style="color:#94a3b8">{{ (currentPage - 1) * rowsPerPage + i + 1
                }}</span></td>
            <td>
              <div class="type-name-cell">
                <div class="type-accent-bar" [class.active]="type.isActive" [class.inactive]="!type.isActive"></div>
                <span class="type-name">{{ type.leaveTypeName }}</span>
              </div>
            </td>
            <td>
              <span
                style="color:#64748b; max-width: 280px; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"
                [title]="type.description">{{ type.description }}</span>
            </td>
            <td class="text-center">
              <span class="alloc-badge">{{ type.maxDaysAllowed }} Days / Year</span>
            </td>
            <td class="text-center">
              <span class="status-pill" [class.active]="type.isActive" [class.inactive]="!type.isActive">
                <iconify-icon
                  [icon]="type.isActive ? 'solar:check-read-linear' : 'solar:close-circle-linear'"></iconify-icon>
                {{ type.isActive ? 'Active' : 'Deactivated' }}
              </span>
            </td>
            <td class="text-center">
              <div class="d-flex align-items-center justify-content-center gap-1">
                <button type="button" (click)="toggleStatus(type)" class="action-btn-glass toggle"
                  [title]="type.isActive ? 'Deactivate' : 'Activate'">
                  <iconify-icon [icon]="type.isActive ? 'solar:eye-closed-linear' : 'solar:eye-linear'"></iconify-icon>
                </button>
                <button type="button" (click)="openEditModal(type)" class="action-btn-glass edit" title="Edit">
                  <iconify-icon icon="solar:pen-new-square-linear"></iconify-icon>
                </button>
                <button type="button" (click)="confirmDelete(type)" class="action-btn-glass delete" title="Delete">
                  <iconify-icon icon="solar:trash-bin-trash-linear"></iconify-icon>
                </button>
              </div>
            </td>
          </tr>
          <tr *ngIf="paginatedTypes.length === 0">
            <td colspan="6" class="text-center" style="padding: 60px 20px;">
              <iconify-icon icon="solar:empty-box-linear" style="font-size: 4rem; color: #c7d2fe;"></iconify-icon>
              <h5 class="mt-3" style="color: #94a3b8; font-weight: 700;">No Leave Types Found</h5>
              <p style="color: #cbd5e1;">Start by adding a new leave configuration</p>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="pagination-bar" *ngIf="filteredTypes.length > 0">
      <p class="pagination-info mb-0">
        Showing <b>{{ (currentPage - 1) * rowsPerPage + 1 }}</b> to
        <b>{{ Math.min(currentPage * rowsPerPage, filteredTypes.length) }}</b> of
        <b>{{ filteredTypes.length }}</b> configurations
      </p>
      <nav>
        <ul class="pagination-pills">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <a class="page-link" (click)="changePage(currentPage - 1)" href="javascript:void(0)">
              <iconify-icon icon="solar:alt-arrow-left-linear"></iconify-icon>
            </a>
          </li>
          <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index"
            [class.active]="currentPage === i + 1">
            <a class="page-link" (click)="changePage(i + 1)" href="javascript:void(0)">{{ i + 1 }}</a>
          </li>
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <a class="page-link" (click)="changePage(currentPage + 1)" href="javascript:void(0)">
              <iconify-icon icon="solar:alt-arrow-right-linear"></iconify-icon>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>

<!-- ══════ Modal ══════ -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal-glass-box" (click)="$event.stopPropagation()">
    <div class="modal-header-glass">
      <div>
        <h4>{{ isEditMode ? 'Edit Configuration' : 'Create Leave Type' }}</h4>
        <p>Define leave policy and allocation limits</p>
      </div>
      <button type="button" class="modal-close" (click)="closeModal()">
        <iconify-icon icon="solar:close-circle-linear"></iconify-icon>
      </button>
    </div>
    <div class="modal-body-glass">
      <form (ngSubmit)="saveLeaveType()">
        <div class="mb-3">
          <label class="form-label-glass">Leave Type Name</label>
          <input type="text" class="field-input-glass" [(ngModel)]="leaveTypeForm.leaveTypeName" name="leaveTypeName"
            placeholder="e.g., Annual Privilege Leave" required />
        </div>
        <div class="mb-3">
          <label class="form-label-glass">Detailed Description</label>
          <textarea class="field-input-glass" [(ngModel)]="leaveTypeForm.description" name="description" rows="3"
            placeholder="Mention eligibility rules, conditions..." required></textarea>
        </div>
        <div class="row g-3 mb-4">
          <div class="col-md-6">
            <label class="form-label-glass">Annual Allocation (Days)</label>
            <input type="number" class="field-input-glass" [(ngModel)]="leaveTypeForm.maxDaysAllowed"
              name="maxDaysAllowed" min="1" placeholder="e.g., 15" required />
          </div>
          <div class="col-md-6">
            <label class="form-label-glass">Availability Status</label>
            <div class="toggle-card" [class.active]="leaveTypeForm.isActive" [class.inactive]="!leaveTypeForm.isActive">
              <div>
                <span class="fw-bold d-block" [style.color]="leaveTypeForm.isActive ? '#16a34a' : '#dc2626'">
                  {{ leaveTypeForm.isActive ? 'Active' : 'Inactive' }}
                </span>
                <small style="color: #94a3b8;">Visible to employees</small>
              </div>
              <div class="form-check form-switch p-0 m-0">
                <input class="form-check-input ms-0" type="checkbox" [(ngModel)]="leaveTypeForm.isActive"
                  name="isActive" style="width: 46px; height: 24px;">
              </div>
            </div>
          </div>
        </div>
        <div class="d-flex align-items-center justify-content-center gap-3 mt-4">
          <button type="button" (click)="closeModal()" class="btn-modal-cancel">Discard</button>
          <button type="submit" class="btn-modal-save">
            {{ isEditMode ? 'Update Configuration' : 'Save & Publish' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>