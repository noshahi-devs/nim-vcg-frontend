<div class="dashboard-main-body">
  <app-breadcrumb [title]="'Student Edit'" [main-title]="'Management'"></app-breadcrumb>

  <!-- LOADING STATE -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2 text-secondary">Fetching student records...</p>
  </div>

  <div *ngIf="!loading && studentData" class="premium-card fade-in-up">

    <!-- HEADER -->
    <div class="card-header-premium">
      <div class="header-title-wrap">
        <h4>Edit Student Profile</h4>
        <p>Update student details and account preferences.</p>
      </div>
      <button type="button" (click)="cancel()" class="btn-cancel d-flex align-items-center gap-2">
        <iconify-icon icon="solar:arrow-left-linear"></iconify-icon>
        Back to List
      </button>
    </div>

    <!-- TABS -->
    <div class="premium-tabs">
      <ul class="nav nav-tabs border-0" id="editTabs" role="tablist">
        <li class="nav-item">
          <button class="nav-link-premium active" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile"
            type="button">
            Personal Information
          </button>
        </li>
        <li class="nav-item">
          <button class="nav-link-premium" id="guardian-tab" data-bs-toggle="tab" data-bs-target="#guardian"
            type="button">
            Guardian & Contact
          </button>
        </li>
        <li class="nav-item">
          <button class="nav-link-premium" id="academic-tab" data-bs-toggle="tab" data-bs-target="#academic"
            type="button">
            Academic Status
          </button>
        </li>
      </ul>
    </div>

    <!-- TAB CONTENT -->
    <div class="tab-content" id="editTabsContent">

      <!-- PROFILE TAB -->
      <div class="tab-pane fade show active" id="profile" role="tabpanel">

        <!-- Avatar Section -->
        <div class="avatar-section">
          <div class="avatar-upload-wrap">
            <div class="avatar-preview-box">
              <img [src]="studentData.imagePath || 'assets/images/user-grid/user-grid-img2.png'" id="imagePreview"
                alt="Profile">
            </div>
            <label for="imageUpload" class="avatar-edit-btn">
              <iconify-icon icon="solar:camera-bold"></iconify-icon>
              <input type="file" id="imageUpload" hidden (change)="readURL($event.target)">
            </label>
          </div>
          <div class="avatar-info">
            <h5 class="mb-1 fw-bold text-neutral-900">{{ studentData.studentName || 'Student Name' }}</h5>
            <p class="text-xs text-secondary-light mb-0">ID: #{{ studentData.studentId }}</p>
          </div>
        </div>

        <div class="form-body-premium">
          <div class="section-label">
            <span class="section-dot"></span>
            Basic Information
          </div>

          <div class="row">
            <!-- Full Name -->
            <div class="col-md-6 form-group-premium">
              <label class="field-label">Full Name</label>
              <input type="text" class="field-input" [(ngModel)]="studentData.studentName"
                placeholder="Enter full name">
            </div>

            <!-- Email -->
            <div class="col-md-6 form-group-premium">
              <label class="field-label">Email Address</label>
              <input type="email" class="field-input" [(ngModel)]="studentData.studentEmail"
                placeholder="example@mail.com">
            </div>

            <!-- Gender -->
            <div class="col-md-4 form-group-premium">
              <label class="field-label">Gender</label>
              <select class="field-select" [(ngModel)]="studentData.studentGender">
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <!-- DOB -->
            <div class="col-md-4 form-group-premium">
              <label class="field-label">Date of Birth</label>
              <input type="date" class="field-input" [(ngModel)]="studentData.studentDOB">
            </div>

            <!-- Religion -->
            <div class="col-md-4 form-group-premium">
              <label class="field-label">Religion</label>
              <input type="text" class="field-input" [(ngModel)]="studentData.studentReligion" placeholder="e.g. Islam">
            </div>

            <!-- Address -->
            <div class="col-12 form-group-premium">
              <label class="field-label">Permanent Address</label>
              <textarea class="field-input" rows="3" [(ngModel)]="studentData.permanentAddress"
                placeholder="Enter full address..."></textarea>
            </div>
          </div>
        </div>
      </div>

      <!-- GUARDIAN TAB -->
      <div class="tab-pane fade" id="guardian" role="tabpanel">
        <div class="form-body-premium">
          <div class="section-label">
            <span class="section-dot" style="background: #fbbf24; box-shadow: 0 0 8px rgba(251, 191, 36, 0.4);"></span>
            Parental / Guardian Details
          </div>

          <div class="row">
            <!-- Father Name -->
            <div class="col-md-6 form-group-premium">
              <label class="field-label">Father's Name</label>
              <input type="text" class="field-input" [(ngModel)]="studentData.fatherName"
                placeholder="Enter father's name">
            </div>
            <!-- Father Contact -->
            <div class="col-md-6 form-group-premium">
              <label class="field-label">Father's Contact</label>
              <input type="text" class="field-input" [(ngModel)]="studentData.fatherContactNumber"
                placeholder="03xx-xxxxxxx">
            </div>

            <!-- Mother Name -->
            <div class="col-md-6 form-group-premium">
              <label class="field-label">Mother's Name</label>
              <input type="text" class="field-input" [(ngModel)]="studentData.motherName"
                placeholder="Enter mother's name">
            </div>
            <!-- Mother Contact -->
            <div class="col-md-6 form-group-premium">
              <label class="field-label">Mother's Contact</label>
              <input type="text" class="field-input" [(ngModel)]="studentData.motherContactNumber"
                placeholder="03xx-xxxxxxx">
            </div>

            <!-- Local Guardian -->
            <div class="col-md-6 form-group-premium">
              <label class="field-label">Local Guardian Name</label>
              <input type="text" class="field-input" [(ngModel)]="studentData.localGuardianName"
                placeholder="e.g. Uncle, Aunt">
            </div>
            <!-- Guardian Phone -->
            <div class="col-md-6 form-group-premium">
              <label class="field-label">Guardian Phone</label>
              <input type="text" class="field-input" [(ngModel)]="studentData.guardianPhone" placeholder="03xx-xxxxxxx">
            </div>
          </div>
        </div>
      </div>

      <!-- ACADEMIC TAB -->
      <div class="tab-pane fade" id="academic" role="tabpanel">
        <div class="form-body-premium">
          <div class="section-label">
            <span class="section-dot" style="background: #10b981; box-shadow: 0 0 8px rgba(16, 185, 129, 0.4);"></span>
            Institutional Records
          </div>

          <div class="row">
            <!-- Admission No -->
            <div class="col-md-4 form-group-premium">
              <label class="field-label">Admission Number</label>
              <input type="text" class="field-input" [(ngModel)]="studentData.admissionNo" placeholder="REG-xxxx">
            </div>

            <!-- Enrollment No -->
            <div class="col-md-4 form-group-premium">
              <label class="field-label">Enrollment Number</label>
              <input type="text" class="field-input" [(ngModel)]="studentData.enrollmentNo" placeholder="ENR-xxxx">
            </div>

            <!-- Admission Date -->
            <div class="col-md-4 form-group-premium">
              <label class="field-label">Admission Date</label>
              <input type="date" class="field-input" [(ngModel)]="studentData.admissionDate">
            </div>

            <!-- Class (Standard) -->
            <div class="col-md-4 form-group-premium">
              <label class="field-label">Standard / Class</label>
              <select class="field-select" [(ngModel)]="studentData.standardId">
                <option *ngFor="let c of classes" [value]="c.standardId">{{ c.standardName }}</option>
              </select>
            </div>

            <!-- Section -->
            <div class="col-md-4 form-group-premium">
              <label class="field-label">Section</label>
              <select class="field-select" [(ngModel)]="studentData.section" name="section">
                <option *ngFor="let s of sections" [value]="s.sectionName">{{ s.sectionName }} ({{ s.className }})
                </option>
              </select>
            </div>

            <!-- Status -->
            <div class="col-md-4 form-group-premium">
              <label class="field-label">Student Status</label>
              <select class="field-select" [(ngModel)]="studentData.status">
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
              </select>
            </div>

            <!-- Previous School -->
            <div class="col-12 form-group-premium">
              <label class="field-label">Previous Institution</label>
              <input type="text" class="field-input" [(ngModel)]="studentData.previousSchool"
                placeholder="Enter previous school name">
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- FOOTER ACTIONS -->
    <div class="form-footer">
      <button type="button" (click)="cancel()" class="btn-cancel">Discard Changes</button>
      <button type="button" (click)="saveStudent()" class="btn-save-premium">
        Update Student
      </button>
    </div>

  </div>

  <!-- IF NO DATA -->
  <div *ngIf="!loading && !studentData" class="text-center py-5">
    <iconify-icon icon="solar:user-block-outline" class="text-danger" style="font-size: 64px;"></iconify-icon>
    <h5 class="mt-3">Student Not Found</h5>
    <p class="text-muted">The student record you are looking for does not exist.</p>
    <button (click)="cancel()" class="btn btn-primary mt-3">Go Back</button>
  </div>

</div>