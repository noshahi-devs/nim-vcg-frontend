<div class="dashboard-main-body">
  <app-breadcrumb [title]="isTeacher ? 'Teacher Dashboard' : 'School Management'"
    [main-title]="'Dashboard'"></app-breadcrumb>

  <!-- ════════════════════════════════════════════════════════════════
       TEACHER DASHBOARD
  ════════════════════════════════════════════════════════════════ -->
  <ng-container *ngIf="isTeacher">

    <!-- Hero Banner: Animated Greeting -->
    <div class="teacher-hero-banner">
      <div class="hero-bg-orb orb-1"></div>
      <div class="hero-bg-orb orb-2"></div>
      <div class="hero-bg-orb orb-3"></div>
      <div class="hero-content">
        <div class="hero-left">
          <div class="teacher-avatar-ring">
            <div class="teacher-avatar">{{ getInitials(currentStaff?.staffName || 'Teacher') }}</div>
            <div class="avatar-status-dot"></div>
          </div>
          <div class="hero-text">
            <div class="greeting-chip">
              <iconify-icon icon="solar:sun-bold-duotone" class="greeting-icon"></iconify-icon>
              {{ greeting }}
            </div>
            <h2 class="hero-name">{{ currentStaff?.staffName || 'Teacher' }}</h2>
            <p class="hero-role">
              <iconify-icon icon="solar:diploma-bold-duotone"></iconify-icon>
              {{ currentStaff?.designation || 'Teacher' }} &nbsp;·&nbsp;
              <iconify-icon icon="solar:buildings-bold-duotone"></iconify-icon>
              Vision College Gojra
            </p>
          </div>
        </div>
        <div class="hero-right">
          <div class="live-clock">
            <div class="clock-time">{{ currentTime }}</div>
            <div class="clock-date">{{ currentDate }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ─── Stat Cards ─── -->
    <div class="teacher-stats-grid">
      <div class="t-stat-card" *ngFor="let s of teacherStats; let i = index" [style.animation-delay]="(i * 0.08) + 's'">
        <div class="t-stat-icon" [ngStyle]="{ background: s.bg, color: s.color }">
          <iconify-icon [icon]="s.icon" [class.pulse-anim]="s.pulse"></iconify-icon>
        </div>
        <div class="t-stat-info">
          <span class="t-stat-label">{{ s.label }}</span>
          <span class="t-stat-value" [ngStyle]="{ color: s.color }">{{ s.value }}</span>
        </div>
        <div class="t-stat-bar" [ngStyle]="{ background: s.color }"></div>
      </div>
    </div>

    <!-- ─── Main Grid ─── -->
    <div class="teacher-main-grid">

      <!-- ── Assigned Subjects Card ── -->
      <div class="t-card subjects-card">
        <div class="t-card-header">
          <div class="t-card-title">
            <iconify-icon icon="solar:book-bold-duotone" class="title-icon" style="color:#6366f1;"></iconify-icon>
            My Subjects
          </div>
          <span class="t-badge" style="background:rgba(99,102,241,0.1);color:#6366f1;">{{ teacherSubjectPills.length }}
            assigned</span>
        </div>
        <div class="subjects-list" *ngIf="teacherSubjectPills.length > 0; else noSubjects">
          <div class="subject-pill" *ngFor="let sub of teacherSubjectPills; let i = index"
            [style.animation-delay]="(i * 0.07) + 's'">
            <span class="subject-dot"
              [ngStyle]="{'background': ['#6366f1','#0ea5e9','#10b981','#f59e0b','#ec4899','#8b5cf6'][i % 6]}"></span>
            <span class="pill-subject">{{ sub.label }}</span>
            <span class="pill-class" *ngIf="sub.className">{{ sub.className }}<span *ngIf="sub.sectionName"> · {{
                sub.sectionName }}</span></span>
          </div>
        </div>
        <ng-template #noSubjects>
          <div class="t-empty">
            <iconify-icon icon="solar:book-linear"></iconify-icon>
            <p>No subjects assigned yet</p>
          </div>
        </ng-template>
      </div>

      <!-- ── Assigned Classes & Sections ── -->
      <div class="t-card classes-card">
        <div class="t-card-header">
          <div class="t-card-title">
            <iconify-icon icon="solar:buildings-bold-duotone" class="title-icon" style="color:#0ea5e9;"></iconify-icon>
            My Classes & Sections
          </div>
        </div>
        <div class="classes-sections-grid" *ngIf="classSectionMap.length > 0; else noClasses">
          <div *ngFor="let item of classSectionMap; let i = index" class="class-section-item"
            [style.animation-delay]="(i * 0.09) + 's'">
            <div class="class-badge">
              <iconify-icon icon="solar:buildings-bold-duotone"></iconify-icon>
              {{ item.className }}
            </div>
            <div class="section-tags">
              <span class="section-tag" *ngFor="let sec of item.sections">{{ sec }}</span>
              <span class="section-tag" *ngIf="item.sections.length === 0" style="opacity:0.5;">—</span>
            </div>
          </div>
        </div>
        <ng-template #noClasses>
          <div class="t-empty">
            <iconify-icon icon="solar:buildings-linear"></iconify-icon>
            <p>No classes assigned yet</p>
          </div>
        </ng-template>
      </div>

      <!-- ── Subject Distribution Donut ── -->
      <div class="t-card chart-card" *ngIf="teacherSubjectPills.length > 0">
        <div class="t-card-header">
          <div class="t-card-title">
            <iconify-icon icon="solar:chart-bold-duotone" class="title-icon" style="color:#10b981;"></iconify-icon>
            Subject Distribution
          </div>
        </div>
        <apx-chart [series]="donutChartOptions?.series" [chart]="donutChartOptions?.chart"
          [colors]="donutChartOptions?.colors" [labels]="donutChartOptions?.labels" [legend]="donutChartOptions?.legend"
          [plotOptions]="donutChartOptions?.plotOptions" [dataLabels]="donutChartOptions?.dataLabels"
          [stroke]="donutChartOptions?.stroke">
        </apx-chart>
      </div>

    </div>

    <!-- ─── Quick Actions Grid ─── -->
    <div class="quick-actions-section">
      <div class="section-header">
        <h5 class="section-title">
          <iconify-icon icon="solar:magic-stick-3-bold-duotone" style="color:#f59e0b;"></iconify-icon>
          Quick Actions
        </h5>
        <p class="section-subtitle">Frequent tasks at your fingertips</p>
      </div>
      <div class="quick-actions-grid">
        <a class="quick-action-tile" *ngFor="let action of quickActions; let i = index" [routerLink]="action.route"
          [style.animation-delay]="(i * 0.07) + 's'">
          <div class="qa-glow" [ngStyle]="{ background: action.color + '33' }"></div>
          <div class="qa-icon" [ngStyle]="{ background: action.color + '20', color: action.color }">
            <iconify-icon [icon]="action.icon"></iconify-icon>
          </div>
          <div class="qa-text">
            <span class="qa-label">{{ action.label }}</span>
            <span class="qa-desc">{{ action.description }}</span>
          </div>
          <iconify-icon icon="solar:alt-arrow-right-linear" class="qa-arrow"></iconify-icon>
        </a>
      </div>
    </div>

    <!-- ─── Teacher Profile Card ─── -->
    <div class="teacher-profile-strip" *ngIf="currentStaff">
      <div class="profile-item">
        <iconify-icon icon="solar:letter-bold-duotone" style="color:#6366f1;"></iconify-icon>
        <div>
          <small>Email</small>
          <span>{{ currentStaff.email }}</span>
        </div>
      </div>
      <div class="profile-divider"></div>
      <div class="profile-item">
        <iconify-icon icon="solar:phone-bold-duotone" style="color:#0ea5e9;"></iconify-icon>
        <div>
          <small>Contact</small>
          <span>{{ currentStaff.contactNumber1 || 'N/A' }}</span>
        </div>
      </div>
      <div class="profile-divider"></div>
      <div class="profile-item">
        <iconify-icon icon="solar:star-bold-duotone" style="color:#f59e0b;"></iconify-icon>
        <div>
          <small>Qualifications</small>
          <span>{{ currentStaff.qualifications || 'N/A' }}</span>
        </div>
      </div>
      <div class="profile-divider"></div>
      <div class="profile-item">
        <iconify-icon icon="solar:calendar-bold-duotone" style="color:#10b981;"></iconify-icon>
        <div>
          <small>Joined</small>
          <span>{{ currentStaff.joiningDate | date:'mediumDate' }}</span>
        </div>
      </div>
      <div class="profile-divider"></div>
      <div class="profile-item">
        <iconify-icon icon="solar:shield-check-bold-duotone" style="color:#ec4899;"></iconify-icon>
        <div>
          <small>Status</small>
          <span class="status-active">{{ currentStaff.status }}</span>
        </div>
      </div>
    </div>

  </ng-container>

  <!-- ════════════════════════════════════════════════════════════════
       ADMIN / PRINCIPAL / OTHER ROLES DASHBOARD
  ════════════════════════════════════════════════════════════════ -->
  <ng-container *ngIf="!isTeacher">

    <div class="row row-cols-xxxl-5 row-cols-lg-3 row-cols-sm-2 row-cols-1 gy-4">
      <div class="col">
        <div class="card shadow-none border bg-gradient-start-1 h-100">
          <div class="card-body p-20">
            <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
              <div>
                <p class="fw-medium text-primary-light mb-1">Total Students</p>
                <h6 class="mb-0">{{ stats?.totalStudents || 0 }}</h6>
              </div>
              <div class="w-50-px h-50-px bg-cyan rounded-circle d-flex justify-content-center align-items-center">
                <iconify-icon icon="ph:student-fill" class="text-white text-2xl mb-0"></iconify-icon>
              </div>
            </div>
            <p class="fw-medium text-sm text-primary-light mt-12 mb-0 d-flex align-items-center gap-2">
              <span class="d-inline-flex align-items-center gap-1 text-success-main"><iconify-icon icon="bxs:up-arrow"
                  class="text-xs"></iconify-icon>+85</span>
              New admissions this month
            </p>
          </div>
        </div>
      </div>
      <div class="col" *ngIf="authService.hasAnyRole(['Admin', 'Principal'])">
        <div class="card shadow-none border bg-gradient-start-2 h-100">
          <div class="card-body p-20">
            <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
              <div>
                <p class="fw-medium text-primary-light mb-1">Total Teachers</p>
                <h6 class="mb-0">{{ stats?.totalTeachers || 0 }}</h6>
              </div>
              <div class="w-50-px h-50-px bg-purple rounded-circle d-flex justify-content-center align-items-center">
                <iconify-icon icon="mdi:teacher" class="text-white text-2xl mb-0"></iconify-icon>
              </div>
            </div>
            <p class="fw-medium text-sm text-primary-light mt-12 mb-0 d-flex align-items-center gap-2">
              <span class="d-inline-flex align-items-center gap-1 text-success-main"><iconify-icon icon="bxs:up-arrow"
                  class="text-xs"></iconify-icon>+5</span>
              New staff this month
            </p>
          </div>
        </div>
      </div>
      <div class="col" *ngIf="authService.hasAnyRole(['Admin', 'Principal'])">
        <div class="card shadow-none border bg-gradient-start-3 h-100">
          <div class="card-body p-20">
            <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
              <div>
                <p class="fw-medium text-primary-light mb-1">Total Classes</p>
                <h6 class="mb-0">{{ stats?.totalClasses || 0 }}</h6>
              </div>
              <div class="w-50-px h-50-px bg-info rounded-circle d-flex justify-content-center align-items-center">
                <iconify-icon icon="mdi:google-classroom" class="text-white text-2xl mb-0"></iconify-icon>
              </div>
            </div>
            <p class="fw-medium text-sm text-primary-light mt-12 mb-0 d-flex align-items-center gap-2">
              <span class="d-inline-flex align-items-center gap-1 text-success-main"><iconify-icon icon="bxs:up-arrow"
                  class="text-xs"></iconify-icon>+3</span>
              New classes this semester
            </p>
          </div>
        </div>
      </div>
      <div class="col" *ngIf="authService.hasAnyRole(['Admin', 'Accountant'])">
        <div class="card shadow-none border bg-gradient-start-4 h-100">
          <div class="card-body p-20">
            <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
              <div>
                <p class="fw-medium text-primary-light mb-1">Fee Collection</p>
                <h6 class="mb-0">{{ stats?.incomeThisMonth || 0 | currency }}</h6>
              </div>
              <div
                class="w-50-px h-50-px bg-success-main rounded-circle d-flex justify-content-center align-items-center">
                <iconify-icon icon="mdi:cash-multiple" class="text-white text-2xl mb-0"></iconify-icon>
              </div>
            </div>
            <p class="fw-medium text-sm text-primary-light mt-12 mb-0 d-flex align-items-center gap-2">
              <span class="d-inline-flex align-items-center gap-1 text-success-main"><iconify-icon icon="bxs:up-arrow"
                  class="text-xs"></iconify-icon>+$35,000</span>
              This month collection
            </p>
          </div>
        </div>
      </div>
      <div class="col" *ngIf="authService.hasAnyRole(['Admin', 'Accountant'])">
        <div class="card shadow-none border bg-gradient-start-5 h-100">
          <div class="card-body p-20">
            <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
              <div>
                <p class="fw-medium text-primary-light mb-1">Total Expenses</p>
                <h6 class="mb-0">{{ stats?.expenseThisMonth || 0 | currency }}</h6>
              </div>
              <div class="w-50-px h-50-px bg-red rounded-circle d-flex justify-content-center align-items-center">
                <iconify-icon icon="mdi:cash-remove" class="text-white text-2xl mb-0"></iconify-icon>
              </div>
            </div>
            <p class="fw-medium text-sm text-primary-light mt-12 mb-0 d-flex align-items-center gap-2">
              <span class="d-inline-flex align-items-center gap-1 text-danger-main"><iconify-icon icon="bxs:up-arrow"
                  class="text-xs"></iconify-icon>+$12,000</span>
              This month expenses
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="row gy-4 mt-1">
      <div class="col-xxl-6 col-xl-12" *ngIf="authService.hasAnyRole(['Admin', 'Accountant'])">
        <div class="card h-100">
          <div class="card-body">
            <div class="d-flex flex-wrap align-items-center justify-content-between">
              <h6 class="text-lg mb-0">Fee Collection Statistics</h6>
              <select class="form-select bg-base form-select-sm w-auto">
                <option>Yearly</option>
                <option>Monthly</option>
                <option>Weekly</option>
                <option>Today</option>
              </select>
            </div>
            <div class="d-flex flex-wrap align-items-center gap-2 mt-8">
              <h6 class="mb-0">$125,000</h6>
              <span
                class="text-sm fw-semibold rounded-pill bg-success-focus text-success-main border br-success px-8 py-4 line-height-1 d-flex align-items-center gap-1">10%
                <iconify-icon icon="bxs:up-arrow" class="text-xs"></iconify-icon></span>
              <span class="text-xs fw-medium">+ $4,200 Per Day</span>
            </div>
            <div id="chart" class="pt-28 apexcharts-tooltip-style-1" style="min-height: 279px;">
              <apx-chart [series]="chartOptions.series" [chart]="chartOptions.chart" [xaxis]="chartOptions.xaxis"
                [yaxis]="chartOptions.yaxis" [stroke]="chartOptions.stroke" [markers]="chartOptions.markers"
                [tooltip]="chartOptions.tooltip" [dataLabels]="chartOptions.dataLabels" [grid]="chartOptions.grid">
              </apx-chart>
            </div>
          </div>
        </div>
      </div>
      <div class="col-xxl-3 col-xl-6">
        <div class="card h-100 radius-8 border">
          <div class="card-body p-24">
            <h6 class="mb-12 fw-semibold text-lg mb-16">Student Enrollment</h6>
            <div class="d-flex align-items-center gap-2 mb-20">
              <h6 class="fw-semibold mb-0">1,250</h6>
              <p class="text-sm mb-0">
                <span
                  class="bg-danger-focus border br-danger px-8 py-2 rounded-pill fw-semibold text-danger-main text-sm d-inline-flex align-items-center gap-1">10%<iconify-icon
                    icon="iconamoon:arrow-down-2-fill" class="icon"></iconify-icon></span>
                + 3 Per Day
              </p>
            </div>
            <div id="barChart" class="barChart">
              <apx-chart [series]="barChartOptions.series" [chart]="barChartOptions.chart"
                [xaxis]="barChartOptions.xaxis" [yaxis]="barChartOptions.yaxis" [fill]="barChartOptions.fill"
                [grid]="barChartOptions.grid" [plotOptions]="barChartOptions.plotOptions"
                [dataLabels]="barChartOptions.dataLabels">
              </apx-chart>
            </div>
          </div>
        </div>
      </div>
      <div class="col-xxl-3 col-xl-6">
        <div class="card h-100 radius-8 border-0 overflow-hidden">
          <div class="card-body p-24">
            <div class="d-flex align-items-center flex-wrap gap-2 justify-content-between">
              <h6 class="mb-2 fw-bold text-lg">Student Overview</h6>
              <select class="form-select form-select-sm w-auto bg-base border text-secondary-light">
                <option>Today</option>
                <option>Weekly</option>
                <option>Monthly</option>
                <option>Yearly</option>
              </select>
            </div>
            <div id="userOverviewDonutChart" class="apexcharts-tooltip-z-none">
              <apx-chart [series]="donutChartOptions.series" [chart]="donutChartOptions.chart"
                [colors]="donutChartOptions.colors" [legend]="donutChartOptions.legend"
                [labels]="donutChartOptions.labels">
              </apx-chart>
            </div>
          </div>
        </div>
      </div>
    </div>

  </ng-container>

</div>