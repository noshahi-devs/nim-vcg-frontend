<div class="dashboard-main-body">
  <app-breadcrumb [title]="title"></app-breadcrumb>

  <!-- Summary Stats -->
  <div class="stats-row animate-fade-up">
    <div class="stat-card">
      <div class="stat-icon-wrapper indigo">
        <iconify-icon icon="solar:users-group-rounded-bold-duotone"></iconify-icon>
      </div>
      <div class="stat-content">
        <span class="stat-label">Total in View</span>
        <h5 class="stat-value">{{ filteredStudents.length }}</h5>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon-wrapper violet">
        <iconify-icon icon="solar:check-square-bold-duotone"></iconify-icon>
      </div>
      <div class="stat-content">
        <span class="stat-label">Selected</span>
        <h5 class="stat-value">{{ selectedStudents.length }}</h5>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon-wrapper emerald">
        <iconify-icon icon="solar:ranking-bold-duotone"></iconify-icon>
      </div>
      <div class="stat-content">
        <span class="stat-label">Current Context</span>
        <h5 class="stat-value text-truncate" style="max-width: 220px;">
          {{ getSelectedClassName() }} {{ selectedSectionId ? ' • ' + getSelectedSectionName() : '' }}
        </h5>
      </div>
    </div>
  </div>

  <!-- Main Table Card -->
  <div class="fee-card animate-fade-up delay-100">
    <div class="fee-card-header">
      <div class="header-left">
        <h6 class="header-title-premium">
          <iconify-icon icon="solar:user-speak-bold-duotone"></iconify-icon>
          Promotion Registry
        </h6>
      </div>

      <div class="header-filters">
        <!-- Search -->
        <div class="search-wrapper">
          <iconify-icon icon="ion:search-outline" class="search-icon"></iconify-icon>
          <input type="text" class="premium-input" [(ngModel)]="searchTerm" (input)="filterStudents()" name="search"
            placeholder="Search students..." />
        </div>

        <!-- Class Filter -->
        <select class="premium-select" [(ngModel)]="selectedClassId" (change)="filterStudents()">
          <option [value]="0">All Classes</option>
          <option *ngFor="let c of classes" [value]="c.standardId">{{ c.standardName }}</option>
        </select>

        <!-- Section Filter -->
        <select class="premium-select" [(ngModel)]="selectedSectionId" (change)="filterStudents()">
          <option [value]="0">All Sections</option>
          <option *ngFor="let s of sections" [value]="s.sectionId">{{ s.sectionName }}</option>
        </select>

        <!-- Rows select -->
        <select class="premium-select" [(ngModel)]="rowsPerPage" (change)="currentPage = 1">
          <option [value]="10">10 Rows</option>
          <option [value]="25">25 Rows</option>
          <option [value]="50">50 Rows</option>
        </select>
      </div>
    </div>

    <div class="fee-card-body p-0">
      <!-- Table UI -->
      <div class="fee-table-wrapper">
        <table class="fee-table">
          <thead>
            <tr>
              <th style="width: 60px; text-align: center;">
                <input type="checkbox" class="custom-checkbox" (change)="toggleAllSelections($event)"
                  [checked]="areAllSelected()" />
              </th>
              <th style="width: 50px;">#</th>
              <th>Student Identity</th>
              <th>Admission No.</th>
              <th class="text-center">Current Context</th>
              <th class="text-center">Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let student of paginatedStudents; let i = index">
              <td class="text-center">
                <input type="checkbox" class="custom-checkbox" [checked]="selectedStudents.includes(student.studentId)"
                  (change)="toggleSelection(student.studentId)" />
              </td>
              <td class="text-secondary-light fw-bold">
                {{ (currentPage - 1) * rowsPerPage + i + 1 }}
              </td>
              <td>
                <div class="student-list-item">
                  <div class="avatar-initial">
                    {{ student.studentName?.charAt(0) }}
                  </div>
                  <div>
                    <span class="class-name">{{ student.studentName }}</span>
                    <span class="class-code text-primary-600">ID: {{ student.studentId }}</span>
                  </div>
                </div>
              </td>
              <td>
                <span class="admission-badge">{{ student.admissionNo }}</span>
              </td>
              <td class="text-center">
                <span class="context-pill">
                  {{ student.standard?.standardName }} • {{ student.section || 'No Gen' }}
                </span>
              </td>
              <td class="text-center">
                <span class="status-badge" [ngClass]="student.status ? 'status-active' : 'status-inactive'">
                  {{ student.status ? 'Active' : 'Inactive' }}
                </span>
              </td>
            </tr>

            <!-- Empty State -->
            <tr *ngIf="paginatedStudents.length === 0 && !loading">
              <td colspan="6" class="text-center py-60">
                <iconify-icon icon="solar:users-group-two-rounded-bold-duotone"
                  style="font-size: 48px; color: #cbd5e1;"></iconify-icon>
                <p class="text-secondary-light mt-12 fw-medium">No students discovered matching these parameters.</p>
              </td>
            </tr>

            <!-- Loading State -->
            <tr *ngIf="loading">
              <td colspan="6" class="text-center py-60">
                <div class="spinner-border text-primary" role="status"></div>
                <p class="text-secondary-light mt-12">Synchronizing registry...</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="pagination-wrap">
        <span class="pagination-info">
          Displaying {{ (currentPage - 1) * rowsPerPage + 1 }} - {{ Math.min(currentPage * rowsPerPage,
          filteredStudents.length) }} of {{ filteredStudents.length }}
        </span>

        <div class="pagination-btns">
          <a class="page-link-premium" [class.disabled]="currentPage === 1" (click)="changePage(currentPage - 1)"
            href="javascript:void(0)">
            <iconify-icon icon="ep:arrow-left"></iconify-icon>
          </a>
          <a *ngFor="let page of [].constructor(totalPages); let i = index" class="page-link-premium"
            [class.active]="currentPage === i + 1" (click)="changePage(i + 1)" href="javascript:void(0)">
            {{ i + 1 }}
          </a>
          <a class="page-link-premium" [class.disabled]="currentPage === totalPages"
            (click)="changePage(currentPage + 1)" href="javascript:void(0)">
            <iconify-icon icon="ep:arrow-right"></iconify-icon>
          </a>
        </div>
      </div>
    </div>

    <!-- PROMOTION ACTION PANEL -->
    <div class="promotion-action-panel animate-fade-up delay-200">
      <div class="panel-glow"></div>
      <div class="panel-header-wrap">
        <h3 class="panel-title">
          <iconify-icon icon="solar:square-academic-cap-bold-duotone"></iconify-icon>
          Smart Promotion Hub
        </h3>
        <p class="panel-subtitle">Finalize the academic transition for {{ selectedStudents.length }} selected records.
        </p>
      </div>

      <div class="destination-controls">
        <div class="control-group">
          <label>Target Academic Class</label>
          <select class="action-select" [(ngModel)]="nextClassId" (change)="onNextClassChange()">
            <option [value]="0">Select Destination Class</option>
            <option *ngFor="let c of classes" [value]="c.standardId">{{ c.standardName }}</option>
          </select>
        </div>

        <div class="control-group">
          <label>Target Academic Section</label>
          <select class="action-select" [(ngModel)]="nextSectionId">
            <option [value]="0">Select Destination Section</option>
            <option *ngFor="let s of filteredNextSections" [value]="s.sectionId">{{ s.sectionName }}</option>
          </select>
        </div>

        <div class="control-group d-flex align-items-end">
          <button class="btn-promote" (click)="promoteSelected()"
            [disabled]="selectedStudents.length === 0 || loading || nextClassId === 0 || nextSectionId === 0">
            <iconify-icon icon="solar:graph-up-bold-duotone"></iconify-icon>
            Promote Selected Records
          </button>
        </div>
      </div>
    </div>
  </div>
</div>