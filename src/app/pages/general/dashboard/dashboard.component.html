<div class="dashboard-main-body">
  <app-breadcrumb [title]="isTeacher ? 'Teacher Dashboard' : 'School Management'"
    [main-title]="'Dashboard'"></app-breadcrumb>

  <!-- ════════════════════════════════════════════════════════════════
       TEACHER DASHBOARD
  ════════════════════════════════════════════════════════════════ -->
  <ng-container *ngIf="isTeacher">

    <!-- Hero Banner: Animated Greeting -->
    <div class="teacher-hero-banner">
      <div class="hero-bg-orb orb-1"></div>
      <div class="hero-bg-orb orb-2"></div>
      <div class="hero-bg-orb orb-3"></div>
      <div class="hero-content">
        <div class="hero-left">
          <div class="teacher-avatar-ring">
            <div class="teacher-avatar">{{ getInitials(currentStaff?.staffName || 'Teacher') }}</div>
            <div class="avatar-status-dot"></div>
          </div>
          <div class="hero-text">
            <div class="greeting-chip">
              <iconify-icon icon="solar:sun-bold-duotone" class="greeting-icon"></iconify-icon>
              {{ greeting }}
            </div>
            <h2 class="hero-name">{{ currentStaff?.staffName || 'Teacher' }}</h2>
            <p class="hero-role">
              <iconify-icon icon="solar:diploma-bold-duotone"></iconify-icon>
              {{ currentStaff?.designation || 'Teacher' }} &nbsp;·&nbsp;
              <iconify-icon icon="solar:buildings-bold-duotone"></iconify-icon>
              Vision College Gojra
            </p>
          </div>
        </div>
        <div class="hero-right">
          <div class="live-clock">
            <div class="clock-time">{{ currentTime }}</div>
            <div class="clock-date">{{ currentDate }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ─── Stat Cards ─── -->
    <div class="teacher-stats-grid">
      <div class="t-stat-card" *ngFor="let s of teacherStats; let i = index" [style.animation-delay]="(i * 0.08) + 's'">
        <div class="t-stat-icon" [ngStyle]="{ background: s.bg, color: s.color }">
          <iconify-icon [icon]="s.icon" [class.pulse-anim]="s.pulse"></iconify-icon>
        </div>
        <div class="t-stat-info">
          <span class="t-stat-label">{{ s.label }}</span>
          <span class="t-stat-value" [ngStyle]="{ color: s.color }">{{ s.value }}</span>
        </div>
        <div class="t-stat-bar" [ngStyle]="{ background: s.color }"></div>
      </div>
    </div>

    <!-- ─── Main Grid ─── -->
    <div class="teacher-main-grid">

      <!-- ── Assigned Subjects Card ── -->
      <div class="t-card subjects-card">
        <div class="t-card-header">
          <div class="t-card-title">
            <iconify-icon icon="solar:book-bold-duotone" class="title-icon" style="color:#6366f1;"></iconify-icon>
            My Subjects
          </div>
          <span class="t-badge" style="background:rgba(99,102,241,0.1);color:#6366f1;">{{ teacherSubjectPills.length }}
            assigned</span>
        </div>
        <div class="subjects-list" *ngIf="teacherSubjectPills.length > 0; else noSubjects">
          <div class="subject-pill" *ngFor="let sub of teacherSubjectPills; let i = index"
            [style.animation-delay]="(i * 0.07) + 's'">
            <span class="subject-dot"
              [ngStyle]="{'background': ['#6366f1','#0ea5e9','#10b981','#f59e0b','#ec4899','#8b5cf6'][i % 6]}"></span>
            <span class="pill-subject">{{ sub.label }}</span>
            <span class="pill-class" *ngIf="sub.className">{{ sub.className }}<span *ngIf="sub.sectionName"> · {{
                sub.sectionName }}</span></span>
          </div>
        </div>
        <ng-template #noSubjects>
          <div class="t-empty">
            <iconify-icon icon="solar:book-linear"></iconify-icon>
            <p>No subjects assigned yet</p>
          </div>
        </ng-template>
      </div>

      <!-- ── Assigned Classes & Sections ── -->
      <div class="t-card classes-card">
        <div class="t-card-header">
          <div class="t-card-title">
            <iconify-icon icon="solar:buildings-bold-duotone" class="title-icon" style="color:#0ea5e9;"></iconify-icon>
            My Classes & Sections
          </div>
        </div>
        <div class="classes-sections-grid" *ngIf="classSectionMap.length > 0; else noClasses">
          <div *ngFor="let item of classSectionMap; let i = index" class="class-section-item"
            [style.animation-delay]="(i * 0.09) + 's'">
            <div class="class-badge">
              <iconify-icon icon="solar:buildings-bold-duotone"></iconify-icon>
              {{ item.className }}
            </div>
            <div class="section-tags">
              <span class="section-tag" *ngFor="let sec of item.sections">{{ sec }}</span>
              <span class="section-tag" *ngIf="item.sections.length === 0" style="opacity:0.5;">—</span>
            </div>
          </div>
        </div>
        <ng-template #noClasses>
          <div class="t-empty">
            <iconify-icon icon="solar:buildings-linear"></iconify-icon>
            <p>No classes assigned yet</p>
          </div>
        </ng-template>
      </div>

      <!-- ── Subject Distribution Donut ── -->
      <div class="t-card chart-card" *ngIf="teacherSubjectPills.length > 0">
        <div class="t-card-header">
          <div class="t-card-title">
            <iconify-icon icon="solar:chart-bold-duotone" class="title-icon" style="color:#10b981;"></iconify-icon>
            Subject Distribution
          </div>
        </div>
        <apx-chart [series]="donutChartOptions?.series" [chart]="donutChartOptions?.chart"
          [colors]="donutChartOptions?.colors" [labels]="donutChartOptions?.labels" [legend]="donutChartOptions?.legend"
          [plotOptions]="donutChartOptions?.plotOptions" [dataLabels]="donutChartOptions?.dataLabels"
          [stroke]="donutChartOptions?.stroke">
        </apx-chart>
      </div>

    </div>

    <!-- ─── Quick Actions Grid ─── -->
    <div class="quick-actions-section">
      <div class="section-header">
        <h5 class="section-title">
          <iconify-icon icon="solar:magic-stick-3-bold-duotone" style="color:#f59e0b;"></iconify-icon>
          Quick Actions
        </h5>
        <p class="section-subtitle">Frequent tasks at your fingertips</p>
      </div>
      <div class="quick-actions-grid">
        <a class="quick-action-tile" *ngFor="let action of quickActions; let i = index" [routerLink]="action.route"
          [style.animation-delay]="(i * 0.07) + 's'">
          <div class="qa-glow" [ngStyle]="{ background: action.color + '33' }"></div>
          <div class="qa-icon" [ngStyle]="{ background: action.color + '20', color: action.color }">
            <iconify-icon [icon]="action.icon"></iconify-icon>
          </div>
          <div class="qa-text">
            <span class="qa-label">{{ action.label }}</span>
            <span class="qa-desc">{{ action.description }}</span>
          </div>
          <iconify-icon icon="solar:alt-arrow-right-linear" class="qa-arrow"></iconify-icon>
        </a>
      </div>
    </div>

    <!-- ─── Teacher Profile Card ─── -->
    <div class="teacher-profile-strip" *ngIf="currentStaff">
      <div class="profile-item">
        <iconify-icon icon="solar:letter-bold-duotone" style="color:#6366f1;"></iconify-icon>
        <div>
          <small>Email</small>
          <span>{{ currentStaff.email }}</span>
        </div>
      </div>
      <div class="profile-divider"></div>
      <div class="profile-item">
        <iconify-icon icon="solar:phone-bold-duotone" style="color:#0ea5e9;"></iconify-icon>
        <div>
          <small>Contact</small>
          <span>{{ currentStaff.contactNumber1 || 'N/A' }}</span>
        </div>
      </div>
      <div class="profile-divider"></div>
      <div class="profile-item">
        <iconify-icon icon="solar:star-bold-duotone" style="color:#f59e0b;"></iconify-icon>
        <div>
          <small>Qualifications</small>
          <span>{{ currentStaff.qualifications || 'N/A' }}</span>
        </div>
      </div>
      <div class="profile-divider"></div>
      <div class="profile-item">
        <iconify-icon icon="solar:calendar-bold-duotone" style="color:#10b981;"></iconify-icon>
        <div>
          <small>Joined</small>
          <span>{{ currentStaff.joiningDate | date:'mediumDate' }}</span>
        </div>
      </div>
      <div class="profile-divider"></div>
      <div class="profile-item">
        <iconify-icon icon="solar:shield-check-bold-duotone" style="color:#ec4899;"></iconify-icon>
        <div>
          <small>Status</small>
          <span class="status-active">{{ currentStaff.status }}</span>
        </div>
      </div>
    </div>

  </ng-container>

  <!-- ════════════════════════════════════════════════════════════════
       ADMIN / PRINCIPAL / ACCOUNTANT DASHBOARD
  ════════════════════════════════════════════════════════════════ -->
  <ng-container *ngIf="!isTeacher">

    <!-- Hero Banner for Management -->
    <div class="teacher-hero-banner management-hero">
      <div class="hero-bg-orb orb-1"></div>
      <div class="hero-bg-orb orb-2"></div>
      <div class="hero-bg-orb orb-3"></div>
      <div class="hero-content">
        <div class="hero-left">
          <div class="teacher-avatar-ring">
            <div class="teacher-avatar">{{ getInitials(authService.userValue?.username || 'Admin') }}</div>
            <div class="avatar-status-dot"></div>
          </div>
          <div class="hero-text">
            <div class="greeting-chip">
              <iconify-icon icon="solar:crown-bold-duotone" class="greeting-icon" style="color:#f59e0b;"></iconify-icon>
              {{ greeting }}
            </div>
            <h2 class="hero-name">{{ authService.userValue?.username || 'Administrator' }}</h2>
            <p class="hero-role">
              <iconify-icon icon="solar:shield-check-bold-duotone"></iconify-icon>
              Management Portal &nbsp;·&nbsp;
              <iconify-icon icon="solar:buildings-bold-duotone"></iconify-icon>
              Vision College Gojra
            </p>
          </div>
        </div>
        <div class="hero-right">
          <div class="live-clock">
            <div class="clock-time">{{ currentTime }}</div>
            <div class="clock-date">{{ currentDate }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ─── Management Stat Cards ─── -->
    <div class="teacher-stats-grid">
      <div class="t-stat-card" *ngFor="let s of overviewStats; let i = index"
        [style.animation-delay]="(i * 0.08) + 's'">
        <div class="t-stat-icon" [ngStyle]="{ background: s.bg, color: s.color }">
          <iconify-icon [icon]="s.icon"></iconify-icon>
        </div>
        <div class="t-stat-info">
          <span class="t-stat-label">{{ s.label }}</span>
          <span class="t-stat-value" [ngStyle]="{ color: s.color }">
            {{ s.isCurrency ? (s.value | currency) : (s.value || 0) }}
          </span>
        </div>
        <div class="t-stat-bar" [ngStyle]="{ background: s.color }"></div>
      </div>
    </div>

    <!-- ─── Charts Row ─── -->
    <div class="row gy-4 mb-28">
      <div class="col-xxl-6 col-xl-12" *ngIf="authService.hasAnyRole(['Admin', 'Accountant'])">
        <div class="t-card h-100">
          <div class="t-card-header">
            <div class="t-card-title">
              <iconify-icon icon="solar:wallet-money-bold-duotone" class="title-icon"
                style="color:#6366f1;"></iconify-icon>
              Fee Collection Statistics
            </div>
            <span class="t-badge" style="background:rgba(99,102,241,0.1);color:#6366f1;">Yearly Trends</span>
          </div>
          <div id="chart" class="apexcharts-tooltip-style-1">
            <apx-chart [series]="chartOptions.series" [chart]="chartOptions.chart" [xaxis]="chartOptions.xaxis"
              [yaxis]="chartOptions.yaxis" [stroke]="chartOptions.stroke" [markers]="chartOptions.markers"
              [tooltip]="chartOptions.tooltip" [dataLabels]="chartOptions.dataLabels" [grid]="chartOptions.grid">
            </apx-chart>
          </div>
        </div>
      </div>

      <div class="col-xxl-3 col-xl-6">
        <div class="t-card h-100">
          <div class="t-card-header">
            <div class="t-card-title">
              <iconify-icon icon="solar:user-plus-bold-duotone" class="title-icon"
                style="color:#0ea5e9;"></iconify-icon>
              Recent Admissions
            </div>
          </div>
          <div id="barChart" class="barChart">
            <apx-chart [series]="barChartOptions.series" [chart]="barChartOptions.chart" [xaxis]="barChartOptions.xaxis"
              [yaxis]="barChartOptions.yaxis" [fill]="barChartOptions.fill" [grid]="barChartOptions.grid"
              [plotOptions]="barChartOptions.plotOptions" [dataLabels]="barChartOptions.dataLabels">
            </apx-chart>
          </div>
        </div>
      </div>

      <div class="col-xxl-3 col-xl-6">
        <div class="t-card h-100">
          <div class="t-card-header">
            <div class="t-card-title">
              <iconify-icon icon="solar:chart-bold-duotone" class="title-icon" style="color:#10b981;"></iconify-icon>
              Student Distribution
            </div>
          </div>
          <div id="userOverviewDonutChart" class="apexcharts-tooltip-z-none">
            <apx-chart [series]="donutChartOptions.series" [chart]="donutChartOptions.chart"
              [colors]="donutChartOptions.colors" [legend]="donutChartOptions.legend"
              [labels]="donutChartOptions.labels">
            </apx-chart>
          </div>
        </div>
      </div>
    </div>

    <!-- ─── Role-Based Quick Actions ─── -->
    <div class="quick-actions-section">
      <div class="section-header">
        <h5 class="section-title">
          <iconify-icon icon="solar:magic-stick-3-bold-duotone" style="color:#f59e0b;"></iconify-icon>
          Management Quick Actions
        </h5>
        <p class="section-subtitle">Shortcut tools for your specific role</p>
      </div>

      <!-- Admin Actions Grid -->
      <div class="quick-actions-grid mb-20" *ngIf="authService.hasRole('Admin')">
        <a class="quick-action-tile" *ngFor="let action of adminQuickActions; let i = index" [routerLink]="action.route"
          [style.animation-delay]="(i * 0.06) + 's'">
          <div class="qa-glow" [ngStyle]="{ background: action.color + '33' }"></div>
          <div class="qa-icon" [ngStyle]="{ background: action.color + '20', color: action.color }">
            <iconify-icon [icon]="action.icon"></iconify-icon>
          </div>
          <div class="qa-text">
            <span class="qa-label">{{ action.label }}</span>
            <span class="qa-desc">{{ action.description }}</span>
          </div>
          <iconify-icon icon="solar:alt-arrow-right-linear" class="qa-arrow"></iconify-icon>
        </a>
      </div>

      <!-- Principal Actions (if not admin) -->
      <div class="quick-actions-grid mb-20" *ngIf="authService.hasRole('Principal') && !authService.hasRole('Admin')">
        <a class="quick-action-tile" *ngFor="let action of principalQuickActions; let i = index"
          [routerLink]="action.route" [style.animation-delay]="(i * 0.06) + 's'">
          <div class="qa-glow" [ngStyle]="{ background: action.color + '33' }"></div>
          <div class="qa-icon" [ngStyle]="{ background: action.color + '20', color: action.color }">
            <iconify-icon [icon]="action.icon"></iconify-icon>
          </div>
          <div class="qa-text">
            <span class="qa-label">{{ action.label }}</span>
            <span class="qa-desc">{{ action.description }}</span>
          </div>
          <iconify-icon icon="solar:alt-arrow-right-linear" class="qa-arrow"></iconify-icon>
        </a>
      </div>

      <!-- Accountant Actions (if not admin/principal) -->
      <div class="quick-actions-grid mb-20"
        *ngIf="authService.hasRole('Accountant') && !authService.hasAnyRole(['Admin','Principal'])">
        <a class="quick-action-tile" *ngFor="let action of accountantQuickActions; let i = index"
          [routerLink]="action.route" [style.animation-delay]="(i * 0.06) + 's'">
          <div class="qa-glow" [ngStyle]="{ background: action.color + '33' }"></div>
          <div class="qa-icon" [ngStyle]="{ background: action.color + '20', color: action.color }">
            <iconify-icon [icon]="action.icon"></iconify-icon>
          </div>
          <div class="qa-text">
            <span class="qa-label">{{ action.label }}</span>
            <span class="qa-desc">{{ action.description }}</span>
          </div>
          <iconify-icon icon="solar:alt-arrow-right-linear" class="qa-arrow"></iconify-icon>
        </a>
      </div>
    </div>

  </ng-container>

</div>