<div class="dashboard-main-body">
  <app-breadcrumb [title]="title"></app-breadcrumb>

  <!-- Filters -->
  <div class="card h-100 p-0 radius-12 mb-24">
    <div class="card-header border-bottom bg-base py-16 px-24">
      <div class="row gy-3 align-items-end">
        <div class="col-md-3">
          <label class="form-label fw-semibold mb-2">Transaction Type</label>
          <select class="form-select" [(ngModel)]="filterType" (change)="applyFilters()">
            <option value="">All Types</option>
            <option value="Income">Income</option>
            <option value="Expense">Expense</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label fw-semibold mb-2">From Date</label>
          <input type="date" class="form-control" [(ngModel)]="filterDateFrom" (change)="applyFilters()">
        </div>
        <div class="col-md-3">
          <label class="form-label fw-semibold mb-2">To Date</label>
          <input type="date" class="form-control" [(ngModel)]="filterDateTo" (change)="applyFilters()">
        </div>
        <div class="col-md-3">
          <button type="button" (click)="clearFilters()" class="btn btn-outline-secondary w-100 d-flex align-items-center justify-content-center gap-2">
            <iconify-icon icon="solar:refresh-linear" class="icon text-xl"></iconify-icon>
            Clear Filters
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Ledger Table -->
  <div class="card h-100 p-0 radius-12">
    <div class="card-header border-bottom bg-base py-16 px-24 d-flex align-items-center flex-wrap gap-3 justify-content-between">
      <h6 class="text-lg fw-semibold mb-0">Transaction Ledger</h6>
      <div class="d-flex align-items-center gap-2">
        <button type="button" (click)="loadLedger()" class="btn btn-outline-primary text-sm btn-sm px-12 py-8 radius-8 d-flex align-items-center gap-2">
          <iconify-icon icon="solar:refresh-linear" class="icon text-xl"></iconify-icon>
          Refresh
        </button>
        <button type="button" (click)="exportLedger()" class="btn btn-outline-success text-sm btn-sm px-12 py-8 radius-8 d-flex align-items-center gap-2">
          <iconify-icon icon="solar:export-linear" class="icon text-xl"></iconify-icon>
          Export PDF
        </button>
      </div>
    </div>

    <div class="card-body p-24">
      <div class="table-responsive scroll-sm">
        <table class="table bordered-table sm-table mb-0">
          <thead class="bg-neutral-50">
            <tr>
              <th scope="col">Date</th>
              <th scope="col">Transaction ID</th>
              <th scope="col">Type</th>
              <th scope="col">Category</th>
              <th scope="col">Description</th>
              <th scope="col" class="text-end">Debit</th>
              <th scope="col" class="text-end">Credit</th>
              <th scope="col" class="text-end">Balance</th>
              <th scope="col" class="text-center">Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let transaction of filteredTransactions">
              <td>{{ transaction.date }}</td>
              <td><span class="fw-medium text-primary-600">{{ transaction.transactionId }}</span></td>
              <td><span [ngClass]="getTypeBadgeClass(transaction.type)">{{ transaction.type }}</span></td>
              <td><span class="badge bg-neutral-200 text-neutral-600 px-8 py-4 radius-4 fw-medium text-xs">{{ transaction.category }}</span></td>
              <td>{{ transaction.description }}</td>
              <td class="text-end fw-semibold" [class.text-danger-main]="transaction.debit > 0">
                {{ transaction.debit > 0 ? formatCurrency(transaction.debit) : '-' }}
              </td>
              <td class="text-end fw-semibold" [class.text-success-main]="transaction.credit > 0">
                {{ transaction.credit > 0 ? formatCurrency(transaction.credit) : '-' }}
              </td>
              <td class="text-end fw-bold" [ngClass]="getBalanceClass(transaction.balance)">
                {{ formatCurrency(transaction.balance) }}
              </td>
              <td class="text-center">
                <button type="button" (click)="viewDetails(transaction)" 
                        class="bg-info-focus text-info-600 bg-hover-info-200 fw-medium w-40-px h-40-px d-flex justify-content-center align-items-center rounded-circle" 
                        title="View Details">
                  <iconify-icon icon="solar:eye-linear" class="icon text-xl"></iconify-icon>
                </button>
              </td>
            </tr>
            <tr *ngIf="filteredTransactions.length === 0">
              <td colspan="9" class="text-center py-24 text-secondary-light">No transactions found</td>
            </tr>
          </tbody>
          <tfoot class="bg-neutral-100" *ngIf="filteredTransactions.length > 0">
            <tr>
              <td colspan="5" class="fw-bold text-end">TOTALS:</td>
              <td class="text-end fw-bold text-danger-main">{{ formatCurrency(totalDebit) }}</td>
              <td class="text-end fw-bold text-success-main">{{ formatCurrency(totalCredit) }}</td>
              <td class="text-end fw-bold" [ngClass]="getBalanceClass(finalBalance)">{{ formatCurrency(finalBalance) }}</td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>

      <!-- Summary Info -->
      <div class="row gy-3 mt-24 pt-24 border-top" *ngIf="filteredTransactions.length > 0">
        <div class="col-md-4">
          <div class="d-flex align-items-center gap-3">
            <div class="w-48-px h-48-px bg-danger-focus rounded-circle d-flex justify-content-center align-items-center">
              <iconify-icon icon="mdi:arrow-down" class="text-danger-main text-xl"></iconify-icon>
            </div>
            <div>
              <p class="mb-1 text-secondary-light text-sm">Total Debit</p>
              <h6 class="mb-0 text-danger-main">{{ formatCurrency(totalDebit) }}</h6>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="d-flex align-items-center gap-3">
            <div class="w-48-px h-48-px bg-success-focus rounded-circle d-flex justify-content-center align-items-center">
              <iconify-icon icon="mdi:arrow-up" class="text-success-main text-xl"></iconify-icon>
            </div>
            <div>
              <p class="mb-1 text-secondary-light text-sm">Total Credit</p>
              <h6 class="mb-0 text-success-main">{{ formatCurrency(totalCredit) }}</h6>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="d-flex align-items-center gap-3">
            <div class="w-48-px h-48-px rounded-circle d-flex justify-content-center align-items-center"
                 [ngClass]="finalBalance >= 0 ? 'bg-success-focus' : 'bg-danger-focus'">
              <iconify-icon [icon]="finalBalance >= 0 ? 'mdi:check-circle' : 'mdi:alert-circle'" 
                            [class]="finalBalance >= 0 ? 'text-success-main' : 'text-danger-main'" 
                            class="text-xl"></iconify-icon>
            </div>
            <div>
              <p class="mb-1 text-secondary-light text-sm">Current Balance</p>
              <h6 class="mb-0" [ngClass]="getBalanceClass(finalBalance)">{{ formatCurrency(finalBalance) }}</h6>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>