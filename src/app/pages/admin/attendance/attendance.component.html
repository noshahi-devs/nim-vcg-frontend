<div class="dashboard-main-body">
  <app-breadcrumb [title]="title"></app-breadcrumb>

  <!-- ══════ Stats Grid ══════ -->
  <div class="stats-row">
    <div class="stat-card-glass">
      <div class="stat-icon-circle primary">
        <iconify-icon icon="solar:users-group-two-rounded-bold-duotone"></iconify-icon>
      </div>
      <div class="stat-info">
        <div class="stat-label">Total Students</div>
        <div class="stat-value">{{ students.length }}</div>
      </div>
    </div>

    <div class="stat-card-glass">
      <div class="stat-icon-circle success">
        <iconify-icon icon="solar:check-circle-bold-duotone"></iconify-icon>
      </div>
      <div class="stat-info">
        <div class="stat-label">Present Today</div>
        <div class="stat-value text-success">{{ getStats().present }}</div>
      </div>
    </div>

    <div class="stat-card-glass">
      <div class="stat-icon-circle danger">
        <iconify-icon icon="solar:close-circle-bold-duotone"></iconify-icon>
      </div>
      <div class="stat-info">
        <div class="stat-label">Absent Today</div>
        <div class="stat-value text-danger">{{ getStats().absent }}</div>
      </div>
    </div>

    <div class="stat-card-glass">
      <div class="stat-icon-circle warning">
        <iconify-icon icon="solar:question-square-bold-duotone"></iconify-icon>
      </div>
      <div class="stat-info">
        <div class="stat-label">Unmarked</div>
        <div class="stat-value text-warning">{{ students.length - getStats().present - getStats().absent }}</div>
      </div>
    </div>
  </div>

  <!-- ══════ Filter Section ══════ -->
  <div class="filter-glass">
    <div class="row align-items-end gy-3">
      <div class="col-md-4">
        <label class="form-label">Select Standard</label>
        <div class="input-group">
          <span class="input-group-text">
            <iconify-icon icon="solar:folder-bold-duotone" class="text-primary"></iconify-icon>
          </span>
          <select class="form-select" [(ngModel)]="selectedClass" (change)="loadStudents()">
            <option value="">-- Choose Class --</option>
            <option *ngFor="let std of standards" [value]="std.standardName">
              {{ std.standardName }}
            </option>
          </select>
        </div>
      </div>

      <div class="col-md-4">
        <label class="form-label">Attendance Date</label>
        <div class="input-group">
          <span class="input-group-text">
            <iconify-icon icon="solar:calendar-bold-duotone" class="text-primary"></iconify-icon>
          </span>
          <input type="date" class="form-control" [(ngModel)]="selectedDate" />
        </div>
      </div>

      <div class="col-md-4 d-flex justify-content-end align-items-end gap-2 flex-wrap"
        *ngIf="studentsLoaded && students.length">
        <button class="btn-action-outline success" (click)="markAllPresent()">
          <iconify-icon icon="solar:check-circle-bold-duotone"></iconify-icon>
          All Present
        </button>
        <button class="btn-action-outline danger" (click)="markAllAbsent()">
          <iconify-icon icon="solar:close-circle-bold-duotone"></iconify-icon>
          All Absent
        </button>
      </div>
    </div>
  </div>

  <!-- ══════ Table Section ══════ -->
  <div class="table-glass-container" *ngIf="studentsLoaded && students.length">
    <div class="table-glass-header">
      <h5>Daily Attendance Sheet</h5>
      <div class="action-bar-glass" *ngIf="!hasRole('Admin')">
        <button class="btn-save-grad" (click)="saveAttendance()">
          <iconify-icon icon="solar:diskette-bold-duotone"></iconify-icon>
          Save Final Attendance
        </button>
        <button class="btn-reset-light" (click)="resetForm()">
          <iconify-icon icon="solar:refresh-linear"></iconify-icon>
          Reset
        </button>
      </div>
    </div>

    <div class="table-responsive">
      <table class="premium-table">
        <thead>
          <tr>
            <th class="ps-4">Roll No</th>
            <th>Student Name</th>
            <th class="text-center">Verification</th>
            <th class="text-end pe-4">Status</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let student of students; let i = index" style="animation: fadeInUp 0.4s ease-out both"
            [style.animation-delay]="i * 0.04 + 's'">
            <!-- Roll No -->
            <td class="ps-4">
              <span class="id-badge">
                {{ student.enrollmentNo || 'N/A' }}
              </span>
            </td>
            <!-- Student name -->
            <td>
              <div class="student-info-cell">
                <div class="student-avatar-grad">
                  {{ student.studentName?.charAt(0) }}
                </div>
                <div>
                  <div class="student-name">{{ student.studentName }}</div>
                  <div class="student-id-sub">ID: {{ student.studentId }}</div>
                </div>
              </div>
            </td>
            <!-- Verification -->
            <td class="text-center">
              <iconify-icon *ngIf="student.status === 'Present'" icon="solar:verified-check-bold"
                class="verify-icon present"></iconify-icon>
              <iconify-icon *ngIf="student.status === 'Absent'" icon="solar:danger-bold"
                class="verify-icon absent"></iconify-icon>
              <span *ngIf="!student.status" class="verify-pending">Pending...</span>
            </td>
            <!-- Status toggles -->
            <td class="text-end pe-4">
              <div class="status-toggle-group justify-content-end">
                <button class="status-toggle-btn" [class.active-present]="student.status === 'Present'"
                  (click)="student.status = 'Present'" [disabled]="hasRole('Admin')">Present</button>
                <button class="status-toggle-btn" [class.active-absent]="student.status === 'Absent'"
                  (click)="student.status = 'Absent'" [disabled]="hasRole('Admin')">Absent</button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ══════ Empty State ══════ -->
  <div *ngIf="studentsLoaded && !students.length" class="empty-state-glass">
    <div class="empty-icon-circle">
      <iconify-icon icon="solar:info-square-bold-duotone"></iconify-icon>
    </div>
    <h4>No Students Found</h4>
    <p>Please check if the selected standard has students enrolled.</p>
    <button class="btn-grad-primary" (click)="resetForm()">
      <iconify-icon icon="solar:folder-bold-duotone"></iconify-icon>
      Select Another Class
    </button>
  </div>
</div>