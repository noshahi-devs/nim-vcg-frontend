<div class="dashboard-main-body">
  <app-breadcrumb [title]="title"></app-breadcrumb>

  <div class="card h-100 p-0 radius-12">
    <div class="card-header border-bottom bg-base py-16 px-24 d-flex justify-content-between">
      <div class="d-flex gap-3 align-items-center">
        <span>Show</span>
        <select class="form-select form-select-sm w-auto"
                [(ngModel)]="rowsPerPage"
                (change)="currentPage=1;updatePagination()">
          <option [value]="10">10</option>
          <option [value]="25">25</option>
          <option [value]="50">50</option>
        </select>

        <input type="text"
               class="form-control form-control-sm ms-3"
               placeholder="Search fee types..."
               [(ngModel)]="searchTerm"
               (input)="searchFeeTypes()">
      </div>

      <button class="btn btn-primary btn-sm" (click)="openAddDialog()">
        + Add New Fee Type
      </button>
    </div>

    <div class="card-body p-24">
      <table class="table bordered-table sm-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Fee Type Name</th>
            <th class="text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let ft of paginatedFeeTypes; let i=index">
            <td>{{ (currentPage-1)*rowsPerPage + i + 1 }}</td>
            <td>{{ ft.typeName }}</td>
            <td class="text-center">
              <button class="btn btn-info btn-sm me-1" (click)="openViewDialog(ft)">View</button>
              <button class="btn btn-success btn-sm me-1" (click)="openEditDialog(ft)">Edit</button>
              <button class="btn btn-danger btn-sm" (click)="confirmDelete(ft)">Delete</button>
            </td>
          </tr>

          <tr *ngIf="paginatedFeeTypes.length === 0">
            <td colspan="3" class="text-center">No fee types found</td>
          </tr>
        </tbody>
      </table>

      <div class="d-flex justify-content-between mt-3">
        <span>
          Showing {{ (currentPage-1)*rowsPerPage + 1 }}
          to {{ toEntry }} of {{ filteredFeeTypes.length }} entries
        </span>

        <ul class="pagination">
          <li class="page-item">
            <a class="page-link" (click)="changePage(currentPage-1)">Prev</a>
          </li>
          <li class="page-item"
              *ngFor="let p of [].constructor(totalPages); let i=index">
            <a class="page-link"
               [class.active]="currentPage===i+1"
               (click)="changePage(i+1)">
               {{ i+1 }}
            </a>
          </li>
          <li class="page-item">
            <a class="page-link" (click)="changePage(currentPage+1)">Next</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- Add / Edit Modal -->
<div *ngIf="showAddEditDialog" class="modal-backdrop d-flex align-items-center justify-content-center">
  <div class="modal-content p-3">
    <h5>{{ isEditMode ? 'Edit Fee Type' : 'Add Fee Type' }}</h5>

    <form [formGroup]="form">
      <label class="mt-2">Fee Type Name</label>
      <input class="form-control"
             formControlName="typeName"
             placeholder="Enter fee type name">
    </form>

    <div class="mt-3 text-end">
      <button class="btn btn-secondary me-2" (click)="closeDialog()">Cancel</button>
      <button class="btn btn-primary"
              (click)="saveFeeType()"
              [disabled]="form.invalid">
        {{ isEditMode ? 'Update' : 'Save' }}
      </button>
    </div>
  </div>
</div>

<!-- View Modal -->
<div *ngIf="showViewDialog" class="modal-backdrop d-flex align-items-center justify-content-center">
  <div class="modal-content p-3">
    <h5>Fee Type Details</h5>
    <p><strong>Name:</strong> {{ selectedFeeType?.typeName }}</p>
    <button class="btn btn-secondary" (click)="closeDialog()">Close</button>
  </div>
</div>

<!-- Delete Modal -->
<div *ngIf="showDeleteDialog" class="modal-backdrop d-flex align-items-center justify-content-center">
  <div class="modal-content p-3 text-center">
    <h5 class="text-danger">Confirm Delete</h5>
    <p>
      Are you sure you want to delete
      <strong>{{ feeTypeToDelete?.typeName }}</strong>?
    </p>
    <button class="btn btn-secondary me-2" (click)="closeDialog()">Cancel</button>
    <button class="btn btn-danger" (click)="deleteFeeType()">Delete</button>
  </div>
</div>
