<div class="dashboard-main-body">
  <app-breadcrumb [title]="title"></app-breadcrumb>

  <!-- Filters Card -->
  <div class="card radius-12 mb-4">
    <div class="card-header bg-base py-16 px-24 border-bottom">
      <h6 class="fw-semibold mb-0">Select Filters</h6>
    </div>
    <div class="card-body p-24">
      <div class="row g-3 align-items-end">

        <!-- Date Filter -->
        <div class="col-md-4">
          <label class="form-label fw-semibold">Date <span class="text-danger">*</span></label>
          <input type="date" class="form-control radius-8" [(ngModel)]="selectedDate" />
        </div>

        <!-- Standard Filter -->
        <div class="col-md-4">
          <label class="form-label fw-semibold">Standard</label>
          <select class="form-select radius-8" [(ngModel)]="selectedStandardId">
            <option value="">All Standards</option>
            <option *ngFor="let s of standards" [value]="s.standardId">{{ s.standardName }}</option>
          </select>
        </div>

        <!-- Load Report Button -->
        <div class="col-md-4">
          <button type="button" class="btn btn-primary px-4 py-2 radius-8" (click)="loadReport()">
            <iconify-icon icon="mdi:file-chart" class="me-2"></iconify-icon>
            Load Report
          </button>
        </div>

      </div>
    </div>
  </div>

  <!-- Summary Stats -->
  <div class="row g-3 mb-4" *ngIf="reportLoaded">
    <div class="col-md-3" *ngFor="let stat of summaryStats">
      <div class="card radius-12 h-100">
        <div class="card-body p-24">
          <div class="d-flex align-items-center gap-3">
            <div class="w-64-px h-64-px radius-12 d-flex align-items-center justify-content-center" [ngClass]="stat.bgClass">
              <iconify-icon [icon]="stat.icon" [ngClass]="stat.textClass" style="font-size: 32px;"></iconify-icon>
            </div>
            <div>
              <h6 class="fw-bold mb-1" [ngClass]="stat.textClass">{{ stat.value }}</h6>
              <small class="text-secondary-light">{{ stat.label }}</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Class Cards -->
  <div class="row g-3" *ngIf="reportLoaded">
    <div class="col-md-6 col-lg-4 col-xl-3" *ngFor="let report of classReports">
      <div class="card radius-12 h-100">
        <div class="card-body p-24">

          <!-- Class Header -->
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <h5 class="fw-bold mb-1">{{ report.standardName }}-{{ report.section }}</h5>
              <small class="text-secondary-light">{{ report.totalStudents }} Students</small>
            </div>
            <span class="badge px-3 py-2 radius-8" [ngClass]="report.attendanceMarked ? 'badge-success' : 'badge-danger'">
              {{ report.attendanceMarked ? 'Marked' : 'Not Marked' }}
            </span>
          </div>

          <!-- Attendance Progress -->
          <div class="mb-3" *ngIf="report.attendanceMarked">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span class="text-sm text-secondary-light">Attendance</span>
              <span class="text-sm fw-semibold">{{ report.percentage }}%</span>
            </div>
            <div class="progress" style="height: 8px;">
              <div class="progress-bar"
                [class.bg-success]="report.percentage >= 90"
                [class.bg-warning]="report.percentage >= 75 && report.percentage < 90"
                [class.bg-danger]="report.percentage < 75"
                [style.width.%]="report.percentage">
              </div>
            </div>
          </div>

          <!-- Attendance Breakdown -->
          <div class="row g-2">
            <div class="col-6" *ngFor="let status of ['present','absent','leave','late']">
              <div class="text-center p-2 radius-8" [ngClass]="statusBgClass(status)">
                <h6 class="fw-bold mb-0" [ngClass]="statusTextClass(status)">{{ report[status] }}</h6>
                <small class="text-secondary-light">{{ capitalize(status) }}</small>
              </div>
            </div>
          </div>

          <!-- Unmarked Warning -->
          <div class="alert alert-danger mt-3 mb-0 py-2 px-3" *ngIf="!report.attendanceMarked">
            <div class="d-flex align-items-center gap-2">
              <iconify-icon icon="mdi:alert" style="font-size: 18px;"></iconify-icon>
              <small class="mb-0">Attendance not marked yet</small>
            </div>
          </div>

          <div class="alert alert-warning mt-3 mb-0 py-2 px-3" *ngIf="report.attendanceMarked && report.unmarked > 0">
            <div class="d-flex align-items-center gap-2">
              <iconify-icon icon="mdi:alert-circle" style="font-size: 18px;"></iconify-icon>
              <small class="mb-0">{{ report.unmarked }} student(s) unmarked</small>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div class="card radius-12" *ngIf="!reportLoaded">
    <div class="card-body p-5 text-center">
      <iconify-icon icon="mdi:file-chart-outline" style="font-size: 64px;" class="text-secondary-light mb-3"></iconify-icon>
      <h5 class="mb-2">No Report Loaded</h5>
      <p class="text-secondary-light">Please select a date and click "Load Report" to view class-wise attendance.</p>
    </div>
  </div>
</div>
