<div class="dashboard-main-body">
  <div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-24">
    <app-breadcrumb [title]="title"></app-breadcrumb>
  </div>

  <div class="card basic-data-table radius-12 border-0 shadow-sm overflow-hidden">
    <div class="card-header bg-gradient-primary py-20 px-24 border-bottom-0 d-flex align-items-center gap-2">
      <div class="header-icon-box bg-white-20 radius-8">
        <i class="ri-user-add-line text-white fs-4"></i>
      </div>
      <h5 class="fw-bold mb-0 text-white">Enroll New Student</h5>
    </div>

    <div class="card-body p-32">
      <form #StudentForm="ngForm" (ngSubmit)="onSubmit(StudentForm)" novalidate class="premium-form">

        <!-- Section 1: Basic Identity -->
        <div class="form-section mb-40">
          <div class="form-section-header">
            <span class="section-number">1</span>
            <h6 class="section-title-premium">Student Identity & Photo</h6>
          </div>

          <div class="row g-4">
            <!-- Student Name -->
            <div class="col-md-4">
              <div class="form-group-premium">
                <label class="form-label-premium">
                  <i class="ri-user-line me-2 text-primary-500"></i>Student Name
                </label>
                <div class="input-wrapper-premium">
                  <input type="text" class="form-control-premium" name="studentName" placeholder="Enter full name"
                    [(ngModel)]="newStudent.studentName" #studentName="ngModel" required
                    [ngClass]="{ 'is-invalid': studentName.invalid && studentName.touched }" />
                </div>
                <div *ngIf="studentName.invalid && studentName.touched" class="error-feedback">
                  Required: enter student name
                </div>
              </div>
            </div>

            <!-- Gender -->
            <div class="col-md-4">
              <div class="form-group-premium">
                <label class="form-label-premium">
                  <i class="ri-genderless-line me-2 text-primary-500"></i>Gender
                </label>
                <div class="input-wrapper-premium">
                  <select class="form-select-premium" name="studentGender" [(ngModel)]="newStudent.studentGender"
                    #studentGender="ngModel" required
                    [ngClass]="{ 'is-invalid': studentGender.invalid && studentGender.touched }">
                    <option value="" disabled selected>Select Gender</option>
                    <option [value]="GenderList.Male">Male</option>
                    <option [value]="GenderList.Female">Female</option>
                    <option [value]="GenderList.Other">Other</option>
                  </select>
                </div>
                <div *ngIf="studentGender.invalid && studentGender.touched" class="error-feedback">
                  Selection required
                </div>
              </div>
            </div>

            <!-- Date of Birth -->
            <div class="col-md-4">
              <div class="form-group-premium">
                <label class="form-label-premium">
                  <i class="ri-calendar-2-line me-2 text-primary-500"></i>Birth Date
                </label>
                <div class="input-wrapper-premium">
                  <input type="date" class="form-control-premium" name="studentDOB" [(ngModel)]="studentDOBStr"
                    #studentDOB="ngModel" required
                    [ngClass]="{ 'is-invalid': studentDOB.invalid && studentDOB.touched }" />
                </div>
                <div *ngIf="studentDOB.invalid && studentDOB.touched" class="error-feedback">
                  Birth date is mandatory
                </div>
              </div>
            </div>

            <!-- Class -->
            <div class="col-md-4">
              <div class="form-group-premium">
                <label class="form-label-premium">
                  <i class="ri-graduation-cap-line me-2 text-primary-500"></i>Academic Class
                </label>
                <div class="input-wrapper-premium">
                  <select class="form-select-premium" name="class" [(ngModel)]="newStudent.standardId"
                    #standardId="ngModel" required
                    [ngClass]="{ 'is-invalid': standardId.invalid && standardId.touched }">
                    <option [ngValue]="null" disabled selected>Select Class</option>
                    <option *ngFor="let c of classes" [ngValue]="c.standardId">{{ c.standardName }}</option>
                  </select>
                </div>
                <div *ngIf="standardId.invalid && standardId.touched" class="error-feedback">
                  Class selection required
                </div>
              </div>
            </div>

            <!-- Section -->
            <div class="col-md-4">
              <div class="form-group-premium">
                <label class="form-label-premium">
                  <i class="ri-community-line me-2 text-primary-500"></i>Assigned Section
                </label>
                <div class="input-wrapper-premium">
                  <select class="form-select-premium" name="section" [(ngModel)]="newStudent.section" #section="ngModel"
                    required [ngClass]="{ 'is-invalid': section.invalid && section.touched }">
                    <option value="" disabled selected>Select Section</option>
                    <option value="A">Section A</option>
                    <option value="B">Section B</option>
                    <option value="C">Section C</option>
                    <option value="D">Section D</option>
                  </select>
                </div>
                <div *ngIf="section.invalid && section.touched" class="error-feedback">
                  Section is required
                </div>
              </div>
            </div>

            <!-- Profile Picture -->
            <div class="col-md-4">
              <div class="form-group-premium">
                <label class="form-label-premium">
                  <i class="ri-image-add-line me-2 text-primary-500"></i>Profile Photograph
                </label>
                <div class="input-wrapper-premium">
                  <input type="file" class="form-control-premium" id="imageUpload" (change)="onImageSelected($event)"
                    accept=".png, .jpg, .jpeg" />
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Section 2: Academic Background -->
        <div class="form-section mb-40">
          <div class="form-section-header">
            <span class="section-number">2</span>
            <h6 class="section-title-premium">Academic History & Status</h6>
          </div>

          <div class="row g-4">
            <!-- Admission Date -->
            <div class="col-md-4">
              <div class="form-group-premium">
                <label class="form-label-premium">
                  <i class="ri-calendar-check-line me-2 text-primary-500"></i>Admission Date
                </label>
                <div class="input-wrapper-premium">
                  <input type="date" class="form-control-premium" name="admissionDate" [(ngModel)]="admissionDateStr"
                    #admissionDate="ngModel" required
                    [ngClass]="{ 'is-invalid': admissionDate.invalid && admissionDate.touched }" />
                </div>
              </div>
            </div>

            <!-- Previous School -->
            <div class="col-md-4">
              <div class="form-group-premium">
                <label class="form-label-premium">
                  <i class="ri-building-line me-2 text-primary-500"></i>Previous Institution
                </label>
                <div class="input-wrapper-premium">
                  <input type="text" class="form-control-premium" name="previousSchool" placeholder="Enter school name"
                    [(ngModel)]="newStudent.previousSchool" #previousSchool="ngModel" />
                </div>
              </div>
            </div>

            <!-- Status -->
            <div class="col-md-4">
              <div class="form-group-premium">
                <label class="form-label-premium">
                  <i class="ri-toggle-line me-2 text-primary-500"></i>Enrollment Status
                </label>
                <div class="input-wrapper-premium">
                  <select class="form-select-premium" name="status" [(ngModel)]="newStudent.status" #status="ngModel"
                    required [ngClass]="{ 'is-invalid': status.invalid && status.touched }">
                    <option value="" disabled selected>Toggle Status</option>
                    <option value="active">Active</option>
                    <option value="inactive">Inactive</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Section 3: Contact & Guardian -->
        <div class="form-section">
          <div class="form-section-header">
            <span class="section-number">3</span>
            <h6 class="section-title-premium">Contact Details & Guardian Info</h6>
          </div>

          <div class="row g-4">
            <!-- Student Phone -->
            <div class="col-md-4">
              <div class="form-group-premium">
                <label class="form-label-premium">
                  <i class="ri-phone-line me-2 text-primary-500"></i>Student Contact
                </label>
                <div class="input-wrapper-premium">
                  <input type="text" class="form-control-premium" name="studentContactNumber1"
                    placeholder="0300-1234567" [(ngModel)]="newStudent.studentContactNumber1" pattern="^03\d{2}-\d{7}$"
                    #studentContactNumber1="ngModel" required
                    [ngClass]="{ 'is-invalid': studentContactNumber1.invalid && studentContactNumber1.touched }" />
                </div>
                <div *ngIf="studentContactNumber1.touched && studentContactNumber1.invalid" class="error-feedback">
                  {{ studentContactNumber1.errors?.['pattern'] ? 'Invalid: use 03XX-XXXXXXX' : 'Required' }}
                </div>
              </div>
            </div>

            <!-- Guardian Name -->
            <div class="col-md-4">
              <div class="form-group-premium">
                <label class="form-label-premium">
                  <i class="ri-user-follow-line me-2 text-primary-500"></i>Guardian/Father Name
                </label>
                <div class="input-wrapper-premium">
                  <input type="text" class="form-control-premium" name="guardianName" placeholder="Enter guardian name"
                    [(ngModel)]="newStudent.fatherName" #guardianName="ngModel" required
                    [ngClass]="{ 'is-invalid': guardianName.invalid && guardianName.touched }" />
                </div>
              </div>
            </div>

            <!-- Guardian Phone -->
            <div class="col-md-4">
              <div class="form-group-premium">
                <label class="form-label-premium">
                  <i class="ri-phone-fill me-2 text-primary-500"></i>Guardian Mobile
                </label>
                <div class="input-wrapper-premium">
                  <input type="text" class="form-control-premium" name="guardianPhone" placeholder="0300-1234567"
                    [(ngModel)]="newStudent.guardianPhone" pattern="^03\d{2}-\d{7}$" #guardianPhone="ngModel" required
                    [ngClass]="{ 'is-invalid': guardianPhone.invalid && guardianPhone.touched }" />
                </div>
              </div>
            </div>

            <!-- Address -->
            <div class="col-12">
              <div class="form-group-premium">
                <label class="form-label-premium">
                  <i class="ri-map-pin-line me-2 text-primary-500"></i>Residential Address
                </label>
                <div class="input-wrapper-premium">
                  <textarea class="textarea-premium" rows="3" name="permanentAddress"
                    placeholder="Enter complete permanent residential address" [(ngModel)]="newStudent.permanentAddress"
                    #permanentAddress="ngModel" required
                    [ngClass]="{ 'is-invalid': permanentAddress.invalid && permanentAddress.touched }"></textarea>
                </div>
                <div *ngIf="permanentAddress.invalid && permanentAddress.touched" class="error-feedback">
                  Address is required for verification
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="form-actions-premium mt-40">
          <button type="button" (click)="cancel()" class="btn-premium-danger">
            <i class="ri-close-line me-2"></i>Dismiss
          </button>
          <button type="submit" class="btn-premium-primary">
            <i class="ri-save-3-line me-2"></i>Complete Enrollment
          </button>
        </div>
      </form>
    </div>
  </div>
</div>