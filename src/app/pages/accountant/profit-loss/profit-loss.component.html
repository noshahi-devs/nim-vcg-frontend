<div class="dashboard-main-body">
  <app-breadcrumb [title]="title"></app-breadcrumb>

  <!-- ===================== TOP FILTER BAR ===================== -->
  <div class="fee-card mb-24">
    <div class="fee-card-header flex-wrap" style="border-bottom: none;">
      <div class="d-flex align-items-center flex-wrap gap-16">
        <div class="search-wrapper">
          <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          <input type="date" class="search-input" [(ngModel)]="startDate" style="width:140px; padding-left:32px;"
            title="Start Date *">
        </div>

        <div class="search-wrapper">
          <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          <input type="date" class="search-input" [(ngModel)]="endDate" style="width:140px; padding-left:32px;"
            title="End Date *">
        </div>

        <div class="show-entries">
          <span>Campus</span>
          <select class="entries-select" [(ngModel)]="selectedCampus">
            <option value="">All Campuses</option>
            <option *ngFor="let campus of campuses" [value]="campus">{{ campus }}</option>
          </select>
        </div>

        <button type="button" (click)="generateReport()" class="btn-primary-gradient" style="padding: 10px 20px;">
          <svg viewBox="0 0 24 24" fill="none" class="text-white" stroke="currentColor" stroke-width="2" width="20"
            height="20">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
            <polyline points="14 2 14 8 20 8" />
            <line x1="16" y1="13" x2="8" y2="13" />
            <line x1="16" y1="17" x2="8" y2="17" />
            <polyline points="10 9 9 9 8 9" />
          </svg>
          <span class="text-white">Generate Report</span>
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="report">
    <!-- ===================== STATS CARDS ===================== -->
    <div class="stats-row mb-24">
      <div class="stat-card">
        <div class="stat-icon-wrapper green">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10" />
            <line x1="12" y1="8" x2="12" y2="16" />
            <line x1="8" y1="12" x2="16" y2="12" />
          </svg>
        </div>
        <div class="stat-content">
          <span class="stat-label">Total Income</span>
          <h3 class="stat-value text-success-main">{{ formatCurrency(report.totalIncome) }}</h3>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon-wrapper orange">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10" />
            <line x1="8" y1="12" x2="16" y2="12" />
          </svg>
        </div>
        <div class="stat-content">
          <span class="stat-label">Total Expenses</span>
          <h3 class="stat-value text-danger-main">{{ formatCurrency(report.totalExpenses) }}</h3>
        </div>
      </div>

      <div class="stat-card" [style.border]="report.netProfit >= 0 ? '1px solid #d1fae5' : '1px solid #fee2e2'">
        <div class="stat-icon-wrapper" [ngClass]="report.netProfit >= 0 ? 'green' : 'orange'">
          <svg *ngIf="report.netProfit >= 0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="22 7 13.5 15.5 8.5 10.5 2 17" />
            <polyline points="16 7 22 7 22 13" />
          </svg>
          <svg *ngIf="report.netProfit < 0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="22 17 13.5 8.5 8.5 13.5 2 7" />
            <polyline points="16 17 22 17 22 11" />
          </svg>
        </div>
        <div class="stat-content">
          <span class="stat-label">{{ getProfitLossLabel() }}</span>
          <h3 class="stat-value" [ngClass]="getProfitLossClass()">{{ formatCurrency(Math.abs(report.netProfit)) }}</h3>
        </div>
      </div>
    </div>

    <!-- ===================== CHARTS AND BREAKDOWNS ===================== -->
    <div class="row gy-4 mb-24">

      <!-- Pie Chart section -->
      <div class="col-lg-5">
        <div class="fee-card h-100">
          <div class="fee-card-header">
            <h6 class="text-lg fw-semibold mb-0 text-secondary-dark">Income vs Expenses</h6>
          </div>
          <div class="fee-card-body d-flex align-items-center justify-content-center p-24">
            <apx-chart [series]="chartOptions.series" [chart]="chartOptions.chart" [labels]="chartOptions.labels"
              [colors]="chartOptions.colors" [legend]="chartOptions.legend" [dataLabels]="chartOptions.dataLabels"
              [responsive]="chartOptions.responsive" style="width: 100%; min-height: 350px;"></apx-chart>
          </div>
        </div>
      </div>

      <!-- Categories section -->
      <div class="col-lg-7">
        <div class="fee-card h-100">
          <div class="fee-card-header d-flex justify-content-between align-items-center">
            <h6 class="text-lg fw-semibold mb-0 text-secondary-dark">Category Breakdown</h6>
            <button type="button" (click)="exportReport()" class="btn-add"
              style="background: linear-gradient(135deg, #10b981, #059669);">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                <polyline points="7 10 12 15 17 10" />
                <line x1="12" y1="15" x2="12" y2="3" />
              </svg>
              Export PDF
            </button>
          </div>
          <div class="fee-card-body p-24" style="overflow-y: auto;">

            <div class="row gy-24">
              <!-- Income Table -->
              <div class="col-12">
                <h6 class="text-md fw-semibold mb-12"
                  style="color: #059669; border-bottom: 1px solid #d1fae5; padding-bottom: 8px;">Income Categories</h6>
                <div class="table-wrapper" style="box-shadow: none; border: 1px solid #e2e8f0;">
                  <table class="fee-table">
                    <thead style="background: #f8fafc;">
                      <tr>
                        <th>Category</th>
                        <th class="text-end">Amount</th>
                        <th class="text-end">% Of Total</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr class="table-row" *ngFor="let item of report.incomeByCategory">
                        <td><span class="amount-chip paid">{{ item.category }}</span></td>
                        <td class="text-end fw-semibold text-success-main">{{ formatCurrency(item.amount) }}</td>
                        <td class="text-end text-secondary-light">{{ ((item.amount / report.totalIncome) *
                          100).toFixed(1) }}%</td>
                      </tr>
                      <tr *ngIf="report.incomeByCategory.length === 0">
                        <td colspan="3" class="empty-state py-12">No income records</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- Expense Table -->
              <div class="col-12">
                <h6 class="text-md fw-semibold mb-12"
                  style="color: #e11d48; border-bottom: 1px solid #fee2e2; padding-bottom: 8px;">Expense Categories</h6>
                <div class="table-wrapper" style="box-shadow: none; border: 1px solid #e2e8f0;">
                  <table class="fee-table">
                    <thead style="background: #f8fafc;">
                      <tr>
                        <th>Category</th>
                        <th class="text-end">Amount</th>
                        <th class="text-end">% Of Total</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr class="table-row" *ngFor="let item of report.expenseByCategory">
                        <td><span class="amount-chip due">{{ item.category }}</span></td>
                        <td class="text-end fw-semibold text-danger-main">{{ formatCurrency(item.amount) }}</td>
                        <td class="text-end text-secondary-light">{{ ((item.amount / report.totalExpenses) *
                          100).toFixed(1) }}%</td>
                      </tr>
                      <tr *ngIf="report.expenseByCategory.length === 0">
                        <td colspan="3" class="empty-state py-12">No expense records</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ===================== REPORT SUMMARY FOOTER ===================== -->
    <div class="fee-card p-0 mb-24">
      <div class="fee-card-header">
        <h6 class="text-lg fw-semibold mb-0 text-secondary-dark">Report Parameters & Synopsis</h6>
      </div>
      <div class="fee-card-body p-24">
        <div class="row gy-16">
          <div class="col-md-6 d-flex align-items-center gap-12">
            <div class="p-8 rounded" style="background: #f1f5f9; color: #475569;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                <line x1="16" y1="2" x2="16" y2="6" />
                <line x1="8" y1="2" x2="8" y2="6" />
                <line x1="3" y1="10" x2="21" y2="10" />
              </svg>
            </div>
            <div>
              <p class="mb-2 text-secondary-light text-sm" style="line-height: 1;">Period</p>
              <h6 class="mb-0 text-secondary-dark" style="font-size: 15px;">{{ startDate | date }} - {{ endDate | date
                }}</h6>
            </div>
          </div>

          <div class="col-md-6 d-flex align-items-center gap-12">
            <div class="p-8 rounded" style="background: #f1f5f9; color: #475569;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                <polyline points="9 22 9 12 15 12 15 22" />
              </svg>
            </div>
            <div>
              <p class="mb-2 text-secondary-light text-sm" style="line-height: 1;">Campus Group</p>
              <h6 class="mb-0 text-secondary-dark" style="font-size: 15px;">{{ selectedCampus || 'All Campuses Combined'
                }}</h6>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===================== EMPTY STATE ===================== -->
  <div *ngIf="!report" class="fee-card p-0">
    <div class="fee-card-body py-48 d-flex flex-column align-items-center justify-content-center text-center">
      <div class="mb-16 rounded-circle d-flex align-items-center justify-content-center"
        style="width: 80px; height: 80px; background: #eff6ff; color: #3b82f6;">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="40" height="40">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
          <line x1="16" y1="2" x2="16" y2="6" />
          <line x1="8" y1="2" x2="8" y2="6" />
          <line x1="3" y1="10" x2="21" y2="10" />
          <path d="M8 14h.01" />
          <path d="M12 14h.01" />
          <path d="M16 14h.01" />
          <path d="M8 18h.01" />
          <path d="M12 18h.01" />
          <path d="M16 18h.01" />
        </svg>
      </div>
      <h5 class="text-xl fw-bold text-secondary-dark mb-8">Ready to Analyze Financials</h5>
      <p class="text-secondary-light max-w-sm" style="max-width: 400px; margin: 0 auto;">Select your desired date range
        and campus location above, then click 'Generate Report' to visualize your profit & loss statement.</p>
    </div>
  </div>

</div>