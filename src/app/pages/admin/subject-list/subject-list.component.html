<div class="dashboard-main-body">
  <app-breadcrumb [title]="title"></app-breadcrumb>

  <div class="es-page">
    <!-- ── Stats Row ── -->
    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-icon blue">
          <iconify-icon icon="solar:book-bookmark-bold-duotone"></iconify-icon>
        </div>
        <div class="stat-info">
          <span class="stat-label">Total Subjects</span>
          <span class="stat-value">{{ totalSubjects }}</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon green">
          <iconify-icon icon="solar:users-group-rounded-bold-duotone"></iconify-icon>
        </div>
        <div class="stat-info">
          <span class="stat-label">Impacted Classes</span>
          <span class="stat-value">{{ classesWithSubjectsCount }}</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon orange">
          <iconify-icon icon="solar:graph-bold-duotone"></iconify-icon>
        </div>
        <div class="stat-info">
          <span class="stat-label">Avg/Class</span>
          <span class="stat-value">{{ (totalSubjects / (classesWithSubjectsCount || 1)) | number:'1.0-1' }}</span>
        </div>
      </div>
    </div>

    <!-- ── Top Bar ── -->
    <div class="es-topbar">
      <div class="es-topbar-left">
        <div class="es-search-wrap">
          <iconify-icon icon="solar:magnifer-linear" class="es-search-icon"></iconify-icon>
          <input class="es-search-input" type="text" [(ngModel)]="searchTerm" placeholder="Search subjects..." />
        </div>
        <select class="es-show-select" [(ngModel)]="filterClass">
          <option value="">All Classes</option>
          <option *ngFor="let s of classes" [value]="s">{{ s }}</option>
        </select>
      </div>
      <a routerLink="/subject-add" class="es-add-btn" *ngIf="isAdminOrPrincipal()">
        <iconify-icon icon="solar:add-circle-bold-duotone"></iconify-icon>
        Add Subject
      </a>
    </div>

    <!-- ── Empty State ── -->
    <div class="es-empty" *ngIf="filteredSubjectList.length === 0">
      <div class="es-empty-icon">
        <iconify-icon icon="solar:book-2-bold-duotone"></iconify-icon>
      </div>
      <h5>No Subjects Found</h5>
      <p>Register academic subjects to start managing your curriculum.</p>
      <a routerLink="/subject-add" class="es-add-btn" *ngIf="isAdminOrPrincipal()">
        <iconify-icon icon="solar:add-circle-bold-duotone"></iconify-icon>
        Add First Subject
      </a>
    </div>

    <!-- ── Subject Grid ── -->
    <div class="es-grid" *ngIf="filteredSubjectList.length > 0">
      <div class="es-card" *ngFor="let subject of filteredSubjectList; let i = index">
        <div class="es-card-accent" [ngClass]="'accent-' + (i % 5)"></div>

        <div class="es-card-head">
          <div class="es-card-icon" [ngClass]="'icon-' + (i % 5)">
            <iconify-icon icon="solar:notebook-bold-duotone"></iconify-icon>
          </div>
          <span class="es-badge">#{{ i + 1 }}</span>
        </div>

        <h6 class="es-card-title">{{ subject.subjectName }}</h6>

        <div class="es-meta-list">
          <div class="es-meta-item">
            <iconify-icon icon="solar:layers-minimalistic-bold-duotone"></iconify-icon>
            <span>Class: {{ subject.standard?.standardName }}</span>
          </div>
          <div class="es-meta-item">
            <iconify-icon icon="solar:code-bold-duotone"></iconify-icon>
            <span>Code: {{ subject.subjectCode }}</span>
          </div>
        </div>

        <div class="es-card-actions" *ngIf="isAdminOrPrincipal()">
          <button class="es-action-btn delete" (click)="confirmDelete(subject)" title="Delete Subject">
            <iconify-icon icon="solar:trash-bin-trash-bold-duotone"></iconify-icon>
          </button>
        </div>
      </div>
    </div>
  </div>


  <!-- Delete Confirmation Modal -->
  <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content radius-12">
        <div class="modal-header border-0">
          <h5 class="modal-title fw-semibold text-danger" id="deleteModalLabel">Confirm Delete</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
          <iconify-icon icon="mdi:alert-circle-outline" class="text-danger mb-3"
            style="font-size: 48px;"></iconify-icon>
          <p>Are you sure you want to delete <strong>{{ subjectToDelete?.subjectName }}</strong>?</p>
        </div>
        <div class="modal-footer border-0 d-flex justify-content-center gap-2">
          <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-danger px-4" (click)="deleteSubject()">Yes, Delete</button>
        </div>
      </div>
    </div>
  </div>
</div>