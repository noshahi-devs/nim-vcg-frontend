<div class="dashboard-main-body">
  <app-breadcrumb [title]="title"></app-breadcrumb>

  <!-- Stats Cards -->
  <div class="row gy-4 mb-24">
    <div class="col-xxl-6 col-sm-6">
      <div class="card p-3 shadow-sm radius-12 h-100">
        <div class="card-body p-16">
          <div class="d-flex align-items-center justify-content-between">
            <div>
              <span class="text-secondary-light fw-medium mb-4 d-block">Total Balance</span>
              <h4 class="fw-bold mb-0">${{ totalBalance | number:'1.2-2' }}</h4>
            </div>
            <div class="w-64-px h-64-px radius-12 d-flex justify-content-center align-items-center bg-primary-100">
              <iconify-icon icon="solar:wallet-bold-duotone" class="text-primary-600 text-xxxl"></iconify-icon>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xxl-6 col-sm-6">
      <div class="card p-3 shadow-sm radius-12 h-100">
        <div class="card-body p-16">
          <div class="d-flex align-items-center justify-content-between">
            <div>
              <span class="text-secondary-light fw-medium mb-4 d-block">Active Accounts</span>
              <h4 class="fw-bold mb-0">{{ activeAccountsCount }}</h4>
            </div>
            <div class="w-64-px h-64-px radius-12 d-flex justify-content-center align-items-center bg-success-100">
              <iconify-icon icon="solar:card-check-bold-duotone" class="text-success-600 text-xxxl"></iconify-icon>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Table Card -->
  <div class="card h-100 p-0 radius-12">
    <div
      class="card-header border-bottom bg-base py-16 px-24 d-flex align-items-center flex-wrap gap-3 justify-content-between">
      <h6 class="text-lg fw-semibold mb-0">Bank Accounts & Wallets</h6>
      <button type="button" (click)="openAddModal()"
        class="btn btn-primary text-sm btn-sm px-12 py-12 radius-8 d-flex align-items-center gap-2">
        <iconify-icon icon="ic:baseline-plus" class="icon text-xl line-height-1"></iconify-icon>
        Add Account
      </button>
    </div>

    <div class="card-body p-24">
      <div class="table-responsive scroll-sm">
        <table class="table bordered-table sm-table mb-0">
          <thead>
            <tr>
              <th scope="col">S.L</th>
              <th scope="col">Account Name</th>
              <th scope="col">Bank Name</th>
              <th scope="col">Account Number</th>
              <th scope="col" class="text-end">Balance</th>
              <th scope="col" class="text-center">Status</th>
              <th scope="col" class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let acc of paginatedAccounts; let i = index">
              <td>{{ (currentPage - 1) * rowsPerPage + i + 1 }}</td>
              <td><span class="fw-semibold">{{ acc.accountName }}</span></td>
              <td>{{ acc.bankName }}</td>
              <td>{{ acc.accountNumber }}</td>
              <td class="text-end fw-bold text-primary-600">${{ acc.balance | number:'1.2-2' }}</td>
              <td class="text-center">
                <span class="badge px-12 py-4 radius-4 fw-medium text-sm"
                  [ngClass]="acc.isActive ? 'bg-success-focus text-success-600' : 'bg-danger-focus text-danger-600'">
                  {{ acc.isActive ? 'Active' : 'Inactive' }}
                </span>
              </td>
              <td class="text-center">
                <div class="d-flex align-items-center gap-10 justify-content-center">
                  <button type="button" (click)="openEditModal(acc)"
                    class="bg-success-focus text-success-600 bg-hover-success-200 fw-medium w-40-px h-40-px d-flex justify-content-center align-items-center rounded-circle"
                    title="Edit">
                    <iconify-icon icon="lucide:edit" class="icon text-xl"></iconify-icon>
                  </button>
                  <button type="button" (click)="confirmDelete(acc)"
                    class="bg-danger-focus bg-hover-danger-200 text-danger-600 fw-medium w-40-px h-40-px d-flex justify-content-center align-items-center rounded-circle"
                    title="Delete">
                    <iconify-icon icon="fluent:delete-24-regular" class="icon text-xl"></iconify-icon>
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="paginatedAccounts.length === 0">
              <td colspan="7" class="text-center py-24 text-secondary-light">No accounts found.</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mt-24"
        *ngIf="filteredAccounts.length > 0">
        <span>Showing {{ (currentPage - 1) * rowsPerPage + 1 }} to {{ Math.min(currentPage * rowsPerPage,
          filteredAccounts.length) }} of {{ filteredAccounts.length }} entries</span>
        <ul class="pagination d-flex flex-wrap align-items-center gap-2 justify-content-center">
          <li class="page-item"><a
              class="page-link bg-neutral-200 text-secondary-light fw-semibold radius-8 border-0 d-flex align-items-center justify-content-center h-32-px w-32-px text-md"
              [class.disabled]="currentPage === 1" (click)="changePage(currentPage - 1)"
              href="javascript:void(0)"><iconify-icon icon="ep:d-arrow-left"></iconify-icon></a></li>
          <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index"><a
              class="page-link fw-semibold radius-8 border-0 d-flex align-items-center justify-content-center h-32-px w-32-px text-md"
              [class.bg-primary-600]="currentPage === i + 1" [class.text-white]="currentPage === i + 1"
              [class.bg-neutral-200]="currentPage !== i + 1" [class.text-secondary-light]="currentPage !== i + 1"
              (click)="changePage(i + 1)" href="javascript:void(0)">{{ i + 1 }}</a></li>
          <li class="page-item"><a
              class="page-link bg-neutral-200 text-secondary-light fw-semibold radius-8 border-0 d-flex align-items-center justify-content-center h-32-px w-32-px text-md"
              [class.disabled]="currentPage === totalPages" (click)="changePage(currentPage + 1)"
              href="javascript:void(0)"><iconify-icon icon="ep:d-arrow-right"></iconify-icon></a></li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" [class.show]="showModal" [style.display]="showModal ? 'block' : 'none'" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content radius-16 bg-base">
      <div class="modal-header py-16 px-24 border border-top-0 border-start-0 border-end-0">
        <h5 class="modal-title">{{ isEditMode ? 'Edit Account' : 'Add New Account' }}</h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body p-24">
        <form (ngSubmit)="saveAccount()">
          <div class="mb-3">
            <label class="form-label fw-semibold">Account Name <span class="text-danger">*</span></label>
            <input type="text" class="form-control" [(ngModel)]="accountForm.accountName" name="accountName" required
              placeholder="e.g. Main Cash">
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold">Bank Name</label>
            <input type="text" class="form-control" [(ngModel)]="accountForm.bankName" name="bankName"
              placeholder="e.g. HBL">
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold">Account Number <span class="text-danger">*</span></label>
            <input type="text" class="form-control" [(ngModel)]="accountForm.accountNumber" name="accountNumber"
              required placeholder="e.g. 1234-5678">
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold">Initial Balance</label>
            <input type="number" class="form-control" [(ngModel)]="accountForm.balance" name="balance"
              placeholder="0.00">
          </div>
          <div class="form-check form-switch mb-3">
            <input class="form-check-input" type="checkbox" [(ngModel)]="accountForm.isActive" name="isActive"
              id="isActive">
            <label class="form-check-label" for="isActive">Active</label>
          </div>
          <div class="d-flex justify-content-end gap-2">
            <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button>
            <button type="submit" class="btn btn-primary">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<div class="modal-backdrop fade show" *ngIf="showModal"></div>