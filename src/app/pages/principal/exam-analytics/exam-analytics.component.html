<div class="dashboard-main-body">
  <app-breadcrumb [title]="title"></app-breadcrumb>

  <!-- Control Card -->
  <div class="fee-card mb-24">
    <div class="fee-card-header">
      <div class="header-left">
        <h4 style="margin: 0; font-size: 16px; font-weight: 700; color: #1e293b;">Analytics Configuration</h4>
      </div>
    </div>
    <div class="fee-card-body p-24">
      <div class="row align-items-center">
        <div class="col-md-4">
          <label class="field-label">Select Exam</label>
          <select class="field-input" [(ngModel)]="selectedExamId" (change)="loadAnalytics()">
            <option [ngValue]="null" disabled selected hidden>Select Exam</option>
            <option *ngFor="let exam of exams" [value]="exam.examId">{{ exam.examName }}</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Analytics View -->
  <div *ngIf="analytics && !isLoading">

    <!-- STATS ROW -->
    <div class="stats-row mb-24">
      <div class="stat-card">
        <div class="stat-icon-wrapper blue">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
          </svg>
        </div>
        <div class="stat-content">
          <span class="stat-label">Pass Percentage</span>
          <h3 class="stat-value">{{ analytics.passPercentage }}%</h3>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon-wrapper green">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
            <polyline points="22 4 12 14.01 9 11.01" />
          </svg>
        </div>
        <div class="stat-content">
          <span class="stat-label">Passed Students</span>
          <h3 class="stat-value">{{ analytics.passedStudents }} <span
              style="font-size: 14px; color: #64748b; font-weight: 500;">/ {{ analytics.totalStudents }}</span></h3>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon-wrapper red">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10" />
            <line x1="15" y1="9" x2="9" y2="15" />
            <line x1="9" y1="9" x2="15" y2="15" />
          </svg>
        </div>
        <div class="stat-content">
          <span class="stat-label">Failed Students</span>
          <h3 class="stat-value">{{ analytics.failedStudents }}</h3>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon-wrapper indigo">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="8" r="7" />
            <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88" />
          </svg>
        </div>
        <div class="stat-content">
          <span class="stat-label">Top Performer</span>
          <h3 class="stat-value" style="font-size: 18px; line-height: 28px;">{{ analytics.topPerformer }}</h3>
        </div>
      </div>
    </div>

    <!-- SUBJECT PERFORMANCE TABLE -->
    <div class="fee-card">
      <div class="fee-card-header">
        <div class="header-left">
          <h4 style="margin: 0; font-size: 16px; font-weight: 700; color: #1e293b;">Subject Performance Analysis</h4>
        </div>
      </div>
      <div class="fee-card-body">
        <div class="table-wrapper">
          <table class="fee-table">
            <thead>
              <tr>
                <th>Subject</th>
                <th>Avg Marks</th>
                <th>High Score</th>
                <th>Pass %</th>
              </tr>
            </thead>
            <tbody>
              <tr class="table-row" *ngFor="let sub of analytics.subjectWiseAnalytics">
                <td><span class="amount-val">{{ sub.subjectName }}</span></td>
                <td><span class="badge"
                    style="background: #f1f5f9; color: #475569; padding: 4px 8px; border-radius: 6px; font-weight: 600;">{{
                    sub.averageMarks }}</span></td>
                <td><span class="badge"
                    style="background: #e0e7ff; color: #4338ca; padding: 4px 8px; border-radius: 6px; font-weight: 600;">{{
                    sub.highestMarks }}</span></td>
                <td>
                  <div class="d-flex align-items-center gap-2" style="max-width: 200px;">
                    <div class="progress w-100"
                      style="height: 6px; background-color: #f1f5f9; border-radius: 12px; overflow: hidden;">
                      <div class="progress-bar" role="progressbar" [style.width.%]="sub.passPercentage"
                        [ngStyle]="{'background': sub.passPercentage >= 50 ? 'linear-gradient(135deg, #10b981, #059669)' : 'linear-gradient(135deg, #ef4444, #dc2626)'}">
                      </div>
                    </div>
                    <span style="font-size: 13px; font-weight: 600; color: #475569;">{{ sub.passPercentage }}%</span>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>

  <!-- Empty State -->
  <div class="fee-card" *ngIf="!analytics && selectedExamId && !isLoading">
    <div class="fee-card-body p-40">
      <div class="empty-state">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <line x1="18" y1="20" x2="18" y2="10" />
          <line x1="12" y1="20" x2="12" y2="4" />
          <line x1="6" y1="20" x2="6" y2="14" />
        </svg>
        <p>No analytics data available for the selected exam.</p>
      </div>
    </div>
  </div>

</div>