<div class="dashboard-main-body">
  <app-breadcrumb [title]="title"></app-breadcrumb>

  <!-- ══════ Stats ══════ -->
  <div class="stats-row">
    <div class="stat-card-glass">
      <div class="stat-icon-circle primary">
        <iconify-icon icon="solar:document-text-bold-duotone"></iconify-icon>
      </div>
      <div>
        <div class="stat-label">Aggregate Requests</div>
        <div class="stat-value">{{ totalLeavesCount }}</div>
      </div>
    </div>
    <div class="stat-card-glass">
      <div class="stat-icon-circle warning">
        <iconify-icon icon="solar:clock-circle-bold-duotone"></iconify-icon>
      </div>
      <div>
        <div class="stat-label">Pending Decisions</div>
        <div class="stat-value text-warning">{{ pendingLeavesCount }}</div>
      </div>
    </div>
    <div class="stat-card-glass">
      <div class="stat-icon-circle success">
        <iconify-icon icon="solar:check-circle-bold-duotone"></iconify-icon>
      </div>
      <div>
        <div class="stat-label">Approved</div>
        <div class="stat-value text-success">{{ approvedLeavesCount }}</div>
      </div>
    </div>
    <div class="stat-card-glass">
      <div class="stat-icon-circle danger">
        <iconify-icon icon="solar:close-circle-bold-duotone"></iconify-icon>
      </div>
      <div>
        <div class="stat-label">Rejected</div>
        <div class="stat-value text-danger">{{ rejectedLeavesCount }}</div>
      </div>
    </div>
  </div>

  <!-- ══════ Table ══════ -->
  <div class="table-glass-container">
    <div class="table-glass-header">
      <div>
        <h5>Leave Registry</h5>
        <p>Recent activity from all staff members</p>
      </div>
      <div class="header-actions">
        <button type="button" (click)="refreshData()" class="btn-action-light">
          <iconify-icon icon="solar:refresh-linear"></iconify-icon> Sync
        </button>
        <button type="button" (click)="exportData()" class="btn-action-light">
          <iconify-icon icon="solar:cloud-download-linear"></iconify-icon> Report
        </button>
      </div>
    </div>

    <div class="table-responsive">
      <table class="premium-table">
        <thead>
          <tr>
            <th class="ps-4">S.L</th>
            <th>Employee</th>
            <th>Category</th>
            <th>Duration</th>
            <th class="text-center">Status</th>
            <th class="text-center">Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let leave of paginatedApplications; let i = index" style="animation: fadeInUp 0.4s ease-out both"
            [style.animation-delay]="i * 0.04 + 's'">
            <td class="ps-4"><span style="color:#94a3b8; font-weight:700">{{ (currentPage - 1) * rowsPerPage + i + 1
                }}</span></td>
            <td>
              <div class="d-flex align-items-center gap-3">
                <div class="staff-avatar-grad">{{ (leave.staff?.staffName || '?').charAt(0) }}</div>
                <div>
                  <div class="staff-name">{{ leave.staff?.staffName || 'N/A' }}</div>
                  <div class="staff-role">{{ leave.staff?.designation || 'Staff Member' }}</div>
                </div>
              </div>
            </td>
            <td><span class="category-badge">{{ getLeaveTypeName(leave.leaveType) }}</span></td>
            <td>
              <div class="d-flex align-items-center gap-2" style="font-size: 13px;">
                <iconify-icon icon="solar:calendar-linear" style="color: #c7d2fe;"></iconify-icon>
                <span style="font-weight: 600; color: #1e293b;">
                  {{ leave.startDate | date:'dd MMM yyyy' }}
                </span>
                <span style="color: #cbd5e1;">→</span>
                <span style="font-weight: 600; color: #1e293b;">
                  {{ leave.endDate | date:'dd MMM yyyy' }}
                </span>
              </div>
            </td>
            <td class="text-center">
              <span class="status-pill" [ngClass]="{
                  'pending': leave.status === 0,
                  'approved': leave.status === 1,
                  'rejected': leave.status === 2
                }">
                <iconify-icon
                  [icon]="leave.status === 0 ? 'solar:reorder-bold' : (leave.status === 1 ? 'solar:verified-check-bold' : 'solar:shield-cross-bold')"></iconify-icon>
                {{ getLeaveStatusName(leave.status) }}
              </span>
            </td>
            <td class="text-center">
              <button type="button" (click)="viewDetails(leave)" class="btn-view-glass" title="View Details">
                <iconify-icon icon="solar:magnifer-linear"></iconify-icon>
              </button>
            </td>
          </tr>
          <!-- Empty state -->
          <tr *ngIf="paginatedApplications.length === 0 && !loading">
            <td colspan="6" class="text-center" style="padding: 60px 20px;">
              <iconify-icon icon="solar:folder-error-linear" style="font-size: 4rem; color: #c7d2fe;"></iconify-icon>
              <h5 class="mt-3" style="color: #94a3b8; font-weight: 700;">Registry Empty</h5>
              <p style="color: #cbd5e1;">No leave records found</p>
            </td>
          </tr>
          <!-- Loading state -->
          <tr *ngIf="loading">
            <td colspan="6" class="text-center" style="padding: 60px 20px;">
              <div class="loading-spinner"></div>
              <p class="mt-3" style="color: #94a3b8; font-weight: 600;">Loading data...</p>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="pagination-bar" *ngIf="filteredApplications.length > 0">
      <p class="pagination-info mb-0">
        Page <b>{{ currentPage }}</b> of <b>{{ totalPages }}</b>
      </p>
      <nav>
        <ul class="pagination-pills">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <a class="page-link" (click)="changePage(currentPage - 1)" href="javascript:void(0)">
              <iconify-icon icon="solar:alt-arrow-left-linear"></iconify-icon>
            </a>
          </li>
          <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index"
            [class.active]="currentPage === i + 1">
            <a class="page-link" (click)="changePage(i + 1)" href="javascript:void(0)">{{ i + 1 }}</a>
          </li>
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <a class="page-link" (click)="changePage(currentPage + 1)" href="javascript:void(0)">
              <iconify-icon icon="solar:alt-arrow-right-linear"></iconify-icon>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>