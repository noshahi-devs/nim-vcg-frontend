<div class="dashboard-main-body">
  <app-breadcrumb [title]="title"></app-breadcrumb>

  <!-- ══════ Stats Grid ══════ -->
  <div class="stats-row">
    <div class="stat-card-glass">
      <div class="stat-icon-circle primary">
        <iconify-icon icon="solar:users-group-rounded-bold-duotone"></iconify-icon>
      </div>
      <div class="stat-info">
        <div class="stat-label">Total Staff</div>
        <div class="stat-value">{{ attendanceStats.total }}</div>
      </div>
    </div>

    <div class="stat-card-glass">
      <div class="stat-icon-circle success">
        <iconify-icon icon="solar:check-circle-bold-duotone"></iconify-icon>
      </div>
      <div class="stat-info">
        <div class="stat-label">Present Today</div>
        <div class="stat-value text-success">{{ attendanceStats.present }}</div>
      </div>
    </div>

    <div class="stat-card-glass">
      <div class="stat-icon-circle danger">
        <iconify-icon icon="solar:close-circle-bold-duotone"></iconify-icon>
      </div>
      <div class="stat-info">
        <div class="stat-label">Absent Today</div>
        <div class="stat-value text-danger">{{ attendanceStats.absent }}</div>
      </div>
    </div>

    <div class="stat-card-glass">
      <div class="stat-icon-circle warning">
        <iconify-icon icon="solar:question-square-bold-duotone"></iconify-icon>
      </div>
      <div class="stat-info">
        <div class="stat-label">Unmarked</div>
        <div class="stat-value text-warning">{{ attendanceStats.unmarked }}</div>
      </div>
    </div>
  </div>

  <!-- ══════ Filter Bar ══════ -->
  <div class="filter-glass">
    <div class="row align-items-end gy-3">
      <div class="col-md-3">
        <label class="form-label">Attendance Date</label>
        <div class="input-group">
          <span class="input-group-text">
            <iconify-icon icon="solar:calendar-bold-duotone" class="text-primary"></iconify-icon>
          </span>
          <input type="date" class="form-control" [(ngModel)]="selectedDate">
        </div>
      </div>
      <div class="col-md-4">
        <label class="form-label">Quick Search</label>
        <div class="input-group">
          <span class="input-group-text">
            <iconify-icon icon="solar:magnifer-bold-duotone" class="text-primary"></iconify-icon>
          </span>
          <input type="text" class="form-control" placeholder="Search by name or ID..." [(ngModel)]="searchQuery">
        </div>
      </div>
      <div class="col-md-5 d-flex justify-content-end align-items-end gap-2 flex-wrap">
        <button class="btn-action-outline success" (click)="markAllPresent()" *ngIf="!hasRole('Admin')">
          <iconify-icon icon="solar:check-circle-bold-duotone"></iconify-icon>
          All Present
        </button>
        <button class="btn-action-outline danger" (click)="markAllAbsent()" *ngIf="!hasRole('Admin')">
          <iconify-icon icon="solar:close-circle-bold-duotone"></iconify-icon>
          All Absent
        </button>
        <button class="btn-refresh" (click)="loadStaff()">
          <iconify-icon icon="solar:refresh-linear"></iconify-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- ══════ Data Table ══════ -->
  <div class="table-glass-container">
    <div class="table-glass-header">
      <h5>Staff Attendance Sheet</h5>
      <button class="btn-save-grad" (click)="saveAttendance()" *ngIf="!hasRole('Admin')">
        <iconify-icon icon="solar:diskette-bold-duotone"></iconify-icon>
        Push Attendance to Server
      </button>
    </div>

    <div class="table-responsive">
      <table class="premium-table">
        <thead>
          <tr>
            <th class="ps-4">Staff Member</th>
            <th>Employee ID</th>
            <th class="text-center">Verification</th>
            <th>Attendance Status</th>
            <th class="pe-4">Daily Remarks</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let staff of paginatedStaff; let i = index" style="animation: fadeInUp 0.4s ease-out both"
            [style.animation-delay]="i * 0.04 + 's'">
            <!-- Staff info -->
            <td class="ps-4">
              <div class="staff-info-cell">
                <div class="staff-avatar-grad">
                  {{ staff.staffName?.charAt(0) }}
                </div>
                <div>
                  <div class="staff-name">{{ staff.staffName }}</div>
                  <div class="staff-designation">{{ staff.designation || 'Staff Member' }}</div>
                </div>
              </div>
            </td>
            <!-- ID -->
            <td>
              <span class="id-badge">{{ staff.staffId }}</span>
            </td>
            <!-- Verification -->
            <td class="text-center">
              <iconify-icon *ngIf="staff.status === 'Present'" icon="solar:verified-check-bold"
                class="verify-icon present"></iconify-icon>
              <iconify-icon *ngIf="staff.status === 'Absent'" icon="solar:danger-bold"
                class="verify-icon absent"></iconify-icon>
              <iconify-icon *ngIf="staff.status === 'Leave'" icon="solar:calendar-minimalistic-bold-duotone"
                class="verify-icon leave"></iconify-icon>
              <iconify-icon *ngIf="staff.status === 'Late'" icon="solar:clock-circle-bold-duotone"
                class="verify-icon late"></iconify-icon>
              <span *ngIf="!staff.status" class="verify-pending">Pending...</span>
            </td>
            <!-- Status toggles -->
            <td>
              <div class="status-toggle-group">
                <button class="status-toggle-btn" [class.active-present]="staff.status === 'Present'"
                  (click)="staff.status = 'Present'" [disabled]="hasRole('Admin')">Present</button>
                <button class="status-toggle-btn" [class.active-absent]="staff.status === 'Absent'"
                  (click)="staff.status = 'Absent'" [disabled]="hasRole('Admin')">Absent</button>
                <button class="status-toggle-btn" [class.active-leave]="staff.status === 'Leave'"
                  (click)="staff.status = 'Leave'" [disabled]="hasRole('Admin')">Leave</button>
                <button class="status-toggle-btn" [class.active-late]="staff.status === 'Late'"
                  (click)="staff.status = 'Late'" [disabled]="hasRole('Admin')">Late</button>
              </div>
            </td>
            <!-- Remarks -->
            <td class="pe-4">
              <input type="text" class="remarks-input" [(ngModel)]="staff.remarks" placeholder="Optional comments..."
                [disabled]="hasRole('Admin')">
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="pagination-bar">
      <p class="pagination-info mb-0">
        Showing <b>{{ (currentPage - 1) * itemsPerPage + 1 }}</b> to
        <b>{{ Math.min(currentPage * itemsPerPage, filteredStaff.length) }}</b> of
        <b>{{ filteredStaff.length }}</b> staff
      </p>
      <nav>
        <ul class="pagination-pills">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <button class="page-link" (click)="changePage(currentPage - 1)">
              <iconify-icon icon="solar:alt-arrow-left-linear"></iconify-icon>
            </button>
          </li>
          <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index"
            [class.active]="currentPage === i + 1">
            <button class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</button>
          </li>
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <button class="page-link" (click)="changePage(currentPage + 1)">
              <iconify-icon icon="solar:alt-arrow-right-linear"></iconify-icon>
            </button>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>