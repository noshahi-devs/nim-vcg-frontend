<div class="dashboard-main-body">
  <app-breadcrumb [title]="title"></app-breadcrumb>

  <!-- Stats Cards -->
  <div class="row gy-4 mb-24">
    <div class="col-xxl-3 col-sm-6">
      <div class="card p-3 shadow-sm radius-12 h-100">
        <div class="card-body p-16">
          <div class="d-flex align-items-center justify-content-between">
            <div>
              <span class="text-secondary-light fw-medium mb-4 d-block">Total Requests</span>
              <h4 class="fw-bold mb-0">{{ totalLeaves }}</h4>
            </div>
            <div class="w-64-px h-64-px radius-12 d-flex justify-content-center align-items-center bg-primary-100">
              <iconify-icon icon="solar:document-text-bold-duotone" class="text-primary-600 text-xxxl"></iconify-icon>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xxl-3 col-sm-6">
      <div class="card p-3 shadow-sm radius-12 h-100">
        <div class="card-body p-16">
          <div class="d-flex align-items-center justify-content-between">
            <div>
              <span class="text-secondary-light fw-medium mb-4 d-block">Pending</span>
              <h4 class="fw-bold mb-0">{{ pendingLeaves }}</h4>
            </div>
            <div class="w-64-px h-64-px radius-12 d-flex justify-content-center align-items-center bg-warning-100">
              <iconify-icon icon="solar:clock-circle-bold-duotone" class="text-warning-600 text-xxxl"></iconify-icon>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xxl-3 col-sm-6">
      <div class="card p-3 shadow-sm radius-12 h-100">
        <div class="card-body p-16">
          <div class="d-flex align-items-center justify-content-between">
            <div>
              <span class="text-secondary-light fw-medium mb-4 d-block">Approved</span>
              <h4 class="fw-bold mb-0">{{ approvedLeaves }}</h4>
            </div>
            <div class="w-64-px h-64-px radius-12 d-flex justify-content-center align-items-center bg-success-100">
              <iconify-icon icon="solar:check-circle-bold-duotone" class="text-success-600 text-xxxl"></iconify-icon>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xxl-3 col-sm-6">
      <div class="card p-3 shadow-sm radius-12 h-100">
        <div class="card-body p-16">
          <div class="d-flex align-items-center justify-content-between">
            <div>
              <span class="text-secondary-light fw-medium mb-4 d-block">Rejected</span>
              <h4 class="fw-bold mb-0">{{ rejectedLeaves }}</h4>
            </div>
            <div class="w-64-px h-64-px radius-12 d-flex justify-content-center align-items-center bg-danger-100">
              <iconify-icon icon="solar:close-circle-bold-duotone" class="text-danger-600 text-xxxl"></iconify-icon>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Table Card -->
  <div class="card h-100 p-0 radius-12">
    <div class="card-header border-bottom bg-base py-16 px-24 d-flex align-items-center flex-wrap gap-3 justify-content-between">
      <h6 class="text-lg fw-semibold mb-0">All Staff Leave Requests</h6>
      <div class="d-flex align-items-center gap-2">
        <button type="button" (click)="refreshData()" class="btn btn-outline-primary text-sm btn-sm px-12 py-8 radius-8 d-flex align-items-center gap-2">
          <iconify-icon icon="solar:refresh-linear" class="icon text-xl"></iconify-icon>
          Refresh
        </button>
        <button type="button" (click)="exportData()" class="btn btn-outline-success text-sm btn-sm px-12 py-8 radius-8 d-flex align-items-center gap-2">
          <iconify-icon icon="solar:export-linear" class="icon text-xl"></iconify-icon>
          Export
        </button>
      </div>
    </div>

    <!-- Filters -->
    <div class="card-body p-24 border-bottom">
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label fw-semibold text-sm mb-8">Filter by Status</label>
          <select class="form-select radius-8" [(ngModel)]="statusFilter" (change)="applyFilters()">
            <option value="All">All Status</option>
            <option value="Pending">Pending</option>
            <option value="Approved">Approved</option>
            <option value="Rejected">Rejected</option>
          </select>
        </div>

        <div class="col-md-6">
          <label class="form-label fw-semibold text-sm mb-8">Filter by Leave Type</label>
          <select class="form-select radius-8" [(ngModel)]="leaveTypeFilter" (change)="applyFilters()">
            <option value="All">All Leave Types</option>
            <option *ngFor="let type of leaveTypes" [value]="type">{{ type }}</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Table -->
    <div class="card-body p-24">
      <div class="table-responsive scroll-sm">
        <table class="table bordered-table sm-table mb-0">
          <thead>
            <tr>
              <th scope="col">S.L</th>
              <th scope="col">Staff Name</th>
              <th scope="col">Designation</th>
              <th scope="col">Leave Type</th>
              <th scope="col">From Date</th>
              <th scope="col">To Date</th>
              <th scope="col" class="text-center">Days</th>
              <th scope="col">Reason</th>
              <th scope="col" class="text-center">Status</th>
              <th scope="col" class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let leave of paginatedLeaves; let i = index">
              <td>{{ (currentPage - 1) * rowsPerPage + i + 1 }}</td>
              <td>
                <div class="d-flex align-items-center">
                  <div class="w-40-px h-40-px rounded-circle d-flex justify-content-center align-items-center bg-primary-100 text-primary-600 fw-bold me-12">
                    {{ leave.employeeName.charAt(0) }}
                  </div>
                  <span class="fw-medium">{{ leave.employeeName }}</span>
                </div>
              </td>
              <td>{{ leave.designation }}</td>
              <td>
                <span class="badge bg-primary-50 text-primary-600 px-12 py-4 radius-4 fw-medium text-sm">
                  {{ leave.leaveType }}
                </span>
              </td>
              <td>{{ leave.fromDate }}</td>
              <td>{{ leave.toDate }}</td>
              <td class="text-center">
                <span class="fw-bold">{{ leave.totalDays }}</span>
              </td>
              <td>
                <span class="text-sm" [title]="leave.reason">
                  {{ leave.reason.length > 40 ? leave.reason.substring(0, 40) + '...' : leave.reason }}
                </span>
              </td>
              <td class="text-center">
                <span [ngClass]="getStatusClass(leave.status)">{{ leave.status }}</span>
              </td>
              <td class="text-center">
                <div class="d-flex align-items-center gap-10 justify-content-center" *ngIf="leave.status === 'Pending'">
                  <button 
                    type="button" 
                    (click)="openApproveModal(leave)" 
                    class="bg-success-focus text-success-600 bg-hover-success-200 fw-medium w-40-px h-40-px d-flex justify-content-center align-items-center rounded-circle"
                    title="Approve"
                  >
                    <iconify-icon icon="solar:check-circle-bold" class="icon text-xl"></iconify-icon>
                  </button>
                  <button 
                    type="button" 
                    (click)="openRejectModal(leave)" 
                    class="bg-danger-focus bg-hover-danger-200 text-danger-600 fw-medium w-40-px h-40-px d-flex justify-content-center align-items-center rounded-circle"
                    title="Reject"
                  >
                    <iconify-icon icon="solar:close-circle-bold" class="icon text-xl"></iconify-icon>
                  </button>
                </div>
                <span *ngIf="leave.status !== 'Pending'" class="text-sm text-secondary-light">
                  {{ leave.status }}
                </span>
              </td>
            </tr>
            <tr *ngIf="paginatedLeaves.length === 0">
              <td colspan="10" class="text-center py-24 text-secondary-light">
                <iconify-icon icon="solar:inbox-line-bold-duotone" class="text-xxxl mb-2"></iconify-icon>
                <p class="mb-0">No leave requests found</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mt-24" *ngIf="filteredLeaves.length > 0">
        <span>Showing {{ (currentPage - 1) * rowsPerPage + 1 }} to {{ Math.min(currentPage * rowsPerPage, filteredLeaves.length) }} of {{ filteredLeaves.length }} entries</span>
        <ul class="pagination d-flex flex-wrap align-items-center gap-2 justify-content-center">
          <li class="page-item">
            <a class="page-link bg-neutral-200 text-secondary-light fw-semibold radius-8 border-0 d-flex align-items-center justify-content-center h-32-px w-32-px text-md" 
               [class.disabled]="currentPage === 1"
               (click)="changePage(currentPage - 1)" 
               href="javascript:void(0)">
              <iconify-icon icon="ep:d-arrow-left"></iconify-icon>
            </a>
          </li>
          <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index">
            <a class="page-link fw-semibold radius-8 border-0 d-flex align-items-center justify-content-center h-32-px w-32-px text-md"
               [class.bg-primary-600]="currentPage === i + 1"
               [class.text-white]="currentPage === i + 1"
               [class.bg-neutral-200]="currentPage !== i + 1"
               [class.text-secondary-light]="currentPage !== i + 1"
               (click)="changePage(i + 1)"
               href="javascript:void(0)">
              {{ i + 1 }}
            </a>
          </li>
          <li class="page-item">
            <a class="page-link bg-neutral-200 text-secondary-light fw-semibold radius-8 border-0 d-flex align-items-center justify-content-center h-32-px w-32-px text-md"
               [class.disabled]="currentPage === totalPages"
               (click)="changePage(currentPage + 1)"
               href="javascript:void(0)">
              <iconify-icon icon="ep:d-arrow-right"></iconify-icon>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- Approve/Reject Modal -->
<div class="modal fade" [class.show]="showModal" [style.display]="showModal ? 'block' : 'none'" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content radius-16 bg-base">
      <div class="modal-header py-16 px-24 border border-top-0 border-start-0 border-end-0">
        <h1 class="modal-title fs-5">
          {{ modalAction === 'approve' ? 'Approve' : 'Reject' }} Leave Request
        </h1>
        <button type="button" class="btn-close" (click)="closeModal()" aria-label="Close"></button>
      </div>

      <div class="modal-body p-24" *ngIf="selectedLeave">
        <div class="mb-20">
          <h6 class="fw-semibold mb-12">Leave Details</h6>
          <div class="p-16 bg-neutral-50 radius-8">
            <p class="mb-8"><strong>Employee:</strong> {{ selectedLeave.employeeName }}</p>
            <p class="mb-8"><strong>Designation:</strong> {{ selectedLeave.designation }}</p>
            <p class="mb-8"><strong>Leave Type:</strong> {{ selectedLeave.leaveType }}</p>
            <p class="mb-8"><strong>Duration:</strong> {{ selectedLeave.fromDate }} to {{ selectedLeave.toDate }} ({{ selectedLeave.totalDays }} days)</p>
            <p class="mb-0"><strong>Reason:</strong> {{ selectedLeave.reason }}</p>
          </div>
        </div>

        <div class="mb-20">
          <label class="form-label fw-semibold text-primary-light text-sm mb-8">
            Remarks <span class="text-danger-600">*</span>
          </label>
          <textarea 
            class="form-control radius-8" 
            [(ngModel)]="remarks" 
            name="remarks" 
            rows="4" 
            [placeholder]="'Enter remarks for ' + (modalAction === 'approve' ? 'approval' : 'rejection') + '...'"
            required
          ></textarea>
        </div>

        <div class="d-flex align-items-center justify-content-center gap-3">
          <button type="button" (click)="closeModal()" class="btn btn-outline-secondary text-md px-40 py-11 radius-8">
            Cancel
          </button>
          <button 
            type="button" 
            (click)="confirmAction()" 
            [class]="modalAction === 'approve' ? 'btn btn-success text-md px-48 py-12 radius-8' : 'btn btn-danger text-md px-48 py-12 radius-8'"
          >
            {{ modalAction === 'approve' ? 'Approve' : 'Reject' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Backdrop -->
<div class="modal-backdrop fade" [class.show]="showModal" *ngIf="showModal" (click)="closeModal()"></div>